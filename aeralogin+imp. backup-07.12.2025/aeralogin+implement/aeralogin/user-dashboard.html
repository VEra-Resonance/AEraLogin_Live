<!--
VEra-Resonance ‚Äî User Dashboard (Protected Access)
¬© 2025 Karlheinz Beismann ‚Äî VEra-Resonance Project
Licensed under the Apache License, Version 2.0
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png?v=20251225c">
    <title>AEra User Dashboard - Protected Access</title>
    <!-- CACHE BUST: Force reload after profile editor fix - v20250104-001 -->
    <meta name="description" content="AEra User Dashboard - Protected access for verified identity holders">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0052ff;
            --secondary: #00d4ff;
            --dark: #0a0e27;
            --darker: #050814;
            --light: #f0f4ff;
            --accent: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--light);
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.3;
        }

        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--secondary);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-100px) translateX(50px); }
            50% { transform: translateY(-50px) translateX(-50px); }
            75% { transform: translateY(-150px) translateX(100px); }
        }

        /* Sticky Header Navigation */
        header {
            padding: 0.79rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 14, 39, 0.8);
            width: 100%;
            margin: 0;
        }

        .logo {
            font-size: 2.25rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 2.7rem;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
            -webkit-text-fill-color: currentColor !important;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.85;
            }
        }

        nav, .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        nav a, .nav-menu a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            opacity: 0.8;
            cursor: pointer;
        }

        nav a:hover, .nav-menu a:hover {
            color: var(--secondary);
            opacity: 1;
        }

        /* Mobile Menu Styles */
        .menu-toggle {
            display: none;
            background: transparent;
            border: none;
            color: var(--light);
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1001;
        }

        .menu-toggle:hover {
            color: var(--secondary);
        }

        /* Mobile Menu Overlay */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 300px;
            height: 100vh;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 5rem 2rem 2rem;
            gap: 1.5rem;
            transition: right 0.3s ease;
            z-index: 1000;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
            border-left: 1px solid rgba(99, 102, 241, 0.3);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-menu a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .mobile-menu a:hover {
            background: rgba(99, 102, 241, 0.2);
            color: var(--secondary);
        }
        
        .mobile-menu .disconnect-btn {
            margin-top: 1rem;
        }

        /* Menu Backdrop */
        .menu-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .menu-backdrop.active {
            display: block;
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 0.75rem 3%;
            }

            .logo {
                font-size: 1.8rem;
            }

            .logo-icon {
                font-size: 2rem;
            }

            .menu-toggle {
                display: block;
            }

            .nav-menu:not(.mobile-menu) {
                display: none;
            }
        }

        /* Desktop: Always show nav, hide mobile elements */
        @media (min-width: 769px) {
            .menu-toggle {
                display: none !important;
            }

            .mobile-menu {
                display: none !important;
            }

            .menu-backdrop {
                display: none !important;
            }
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Protection Banner */
        .protection-banner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 255, 0.1));
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .protection-banner-icon {
            font-size: 1.5rem;
        }

        .protection-banner-text .title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--success);
        }

        .protection-banner-text .subtitle {
            font-size: 0.8rem;
            color: var(--light);
            opacity: 0.7;
            margin-top: 2px;
        }

        /* Card Container */
        .card {
            background: rgba(15, 20, 45, 0.6);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(0, 212, 255, 0.5);
            box-shadow: 0 15px 50px rgba(0, 82, 255, 0.2);
        }

        /* Profile Section */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 82, 255, 0.3);
        }

        .profile-info h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .profile-info p {
            color: var(--light);
            opacity: 0.7;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--secondary);
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--light);
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
            line-height: 1.3;
        }

        .stat-value a {
            color: var(--secondary);
            text-decoration: none;
        }

        .stat-value a:hover {
            text-decoration: underline;
        }

        /* Section Title */
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--secondary);
        }

        /* Feed Items */
        .feed-item {
            background: rgba(99, 102, 241, 0.05);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .feed-item:hover {
            border-color: var(--secondary);
            background: rgba(0, 212, 255, 0.05);
        }

        .feed-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .feed-item-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--light);
        }

        .feed-item-timestamp {
            font-size: 0.75rem;
            color: var(--light);
            opacity: 0.5;
        }

        .feed-item-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
        }

        .badge-update {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-security {
            background: rgba(0, 82, 255, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .badge-integration {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            border: 1px solid #a855f7;
        }

        .feed-item-content {
            color: var(--light);
            opacity: 0.8;
            line-height: 1.6;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .feed-item-link {
            color: var(--secondary);
            text-decoration: none;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .feed-item-link:hover {
            gap: 0.75rem;
            color: var(--primary);
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            gap: 0.75rem;
            color: var(--light);
            opacity: 0.7;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-top-color: var(--secondary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Error State */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: 12px;
            padding: 1.5rem;
            color: var(--error);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Disconnect Button */
        .disconnect-btn {
            padding: 0.5rem 1rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            border-radius: 6px;
            color: var(--error);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .disconnect-btn:hover {
            background: var(--error);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--light);
            opacity: 0.6;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Footer */
        footer {
            padding: 2rem;
            text-align: center;
            opacity: 0.6;
            font-size: 0.85rem;
            border-top: 1px solid rgba(99, 102, 241, 0.2);
            margin-top: 3rem;
        }

        footer a {
            color: var(--secondary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-avatar {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .feed-item-header {
                flex-direction: column;
            }

            .protection-banner {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Profile NFT Styles */
        .profile-nft-section {
            margin-top: 2rem;
        }

        .profile-nft-info {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 3px solid var(--secondary);
        }

        .profile-nft-info p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--light);
            opacity: 0.8;
        }

        .profile-nft-not-minted,
        .profile-nft-minted {
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .profile-nft-not-minted h4,
        .profile-nft-minted h4 {
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
            color: var(--light);
        }

        .profile-nft-not-minted p {
            margin: 0 0 1.5rem 0;
            font-size: 0.9rem;
            color: var(--light);
            opacity: 0.7;
        }

        .mint-profile-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mint-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .mint-profile-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .profile-nft-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .profile-nft-status-item {
            background: rgba(99, 102, 241, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .profile-nft-status-item .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--light);
            opacity: 0.6;
            margin-bottom: 0.25rem;
        }

        .profile-nft-status-item .value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--light);
        }

        .profile-nft-status-item .value.public {
            color: var(--success);
        }

        .profile-nft-status-item .value.private {
            color: var(--warning);
        }

        .profile-nft-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .visibility-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .visibility-toggle span {
            font-size: 0.9rem;
            color: var(--light);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(239, 68, 68, 0.5);
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--success);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .profile-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-action-btn.refresh {
            background: rgba(99, 102, 241, 0.2);
            color: var(--secondary);
        }

        .profile-action-btn.refresh:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        .profile-action-btn.burn {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .profile-action-btn.burn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .profile-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .opensea-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(32, 129, 226, 0.2);
            color: #2081E2;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .opensea-link:hover {
            background: rgba(32, 129, 226, 0.3);
        }

        /* ===== CTA Button Styles (matching landing.html / dashboard.html) ===== */
        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .cta-button:hover {
            transform: translateY(-2px);
        }

        .cta-button:active {
            transform: translateY(-1px);
        }

        .cta-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Secondary Button (for Refresh Metadata) */
        .cta-secondary-small {
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            box-shadow: 0 4px 16px rgba(0, 82, 255, 0.3);
        }

        .cta-secondary-small:hover {
            box-shadow: 0 6px 24px rgba(0, 82, 255, 0.4);
        }

        /* Danger Button (for Remove NFT) */
        .cta-danger-small {
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }

        .cta-danger-small:hover {
            box-shadow: 0 6px 24px rgba(239, 68, 68, 0.4);
        }

        /* Success Button (for Enable Free Toggle) */
        .cta-success-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            background: linear-gradient(135deg, var(--success), #059669);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        .cta-success-small:hover {
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
        }

        /* ===== Link Display Styles ===== */
        .link-display {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* ===== Filter Button Styles ===== */
        .filter-btn {
            padding: 6px 12px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--accent);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: white;
        }

        /* ===== Collapse Button Styles ===== */
        .collapse-btn {
            padding: 6px 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .collapse-btn:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        .collapse-btn.collapsed {
            transform: rotate(-90deg);
        }

        /* ===== Collapsible Content ===== */
        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        /* ===== Table Styles ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            font-weight: 600;
            color: var(--secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr {
            transition: background 0.3s;
        }

        .data-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        /* ===== Score Badge ===== */
        .score-badge {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        /* ===== Platform Badge ===== */
        .platform-badge {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--secondary);
        }

        /* ===== BaseScan Link ===== */
        .basescan-link {
            color: var(--secondary);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.3s;
        }

        .basescan-link:hover {
            color: var(--primary);
        }

        /* ===== Responsive Adjustments for New Sections ===== */
        @media (max-width: 768px) {
            .filter-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-btn {
                width: 100%;
                text-align: center;
            }

            .data-table {
                font-size: 0.75rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
        }
        
        /* Security Mode Cards */
        .security-mode-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .security-mode-card.selected {
            border-color: var(--secondary) !important;
            background: rgba(102, 126, 234, 0.1) !important;
        }
        
        /* Setup Steps */
        .setup-step code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85em;
        }
        
        .setup-step a {
            color: var(--secondary);
            text-decoration: none;
        }
        
        .setup-step a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="bg-particles" id="particles"></div>

    <!-- Menu Backdrop -->
    <div class="menu-backdrop" id="menuBackdrop" onclick="toggleMobileMenu()"></div>

    <!-- Header -->
    <header>
        <a href="/" class="logo">
            <span class="logo-icon">üåÄ</span>
            <span>AEraLogIn</span>
        </a>
        
        <!-- Desktop Navigation -->
        <nav class="nav-menu">
            <a href="/">Home</a>
            <a href="/dashboard.html">Dashboard</a>
            <a href="/sdk-docs">SDK & Integration</a>
            <a href="/privacy-policy">Privacy</a>
            <a href="/security-concept.html">Security</a>
            <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
        </nav>

        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">‚ò∞</button>
    </header>

    <!-- Mobile Navigation (outside header for proper z-index stacking) -->
    <nav class="mobile-menu" id="mobileMenu">
        <a href="/" onclick="closeMenu()">Home</a>
        <a href="/dashboard.html" onclick="closeMenu()">Dashboard</a>
        <a href="/sdk-docs" onclick="closeMenu()">SDK & Integration</a>
        <a href="/privacy-policy" onclick="closeMenu()">Privacy</a>
        <a href="/security-concept.html" onclick="closeMenu()">Security</a>
        <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        
        <!-- Protection Banner -->
        <div class="protection-banner">
            <div class="protection-banner-icon">üîê</div>
            <div class="protection-banner-text">
                <div class="title">Protected by AEra LogIn</div>
                <div class="subtitle">This page is only visible to verified AEra Identity NFT holders</div>
            </div>
        </div>

        <!-- Profile Section - TEMPORARILY HIDDEN
        <div class="card" id="profileSection">
            <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-info">
                    <h2 id="profileName">Welcome</h2>
                    <p id="profileAddress">Loading your wallet...</p>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Status</div>
                    <div class="stat-value" id="userStatus">‚Äî</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Resonance Score</div>
                    <div class="stat-value" id="userScore">‚Äî</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Community Access</div>
                    <div class="stat-value" id="communityCount">‚Äî</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Member Since</div>
                    <div class="stat-value" id="memberSince">‚Äî</div>
                </div>
            </div>
        </div>
        END TEMPORARILY HIDDEN -->

        <!-- ===== OWNER STATS SECTION ===== -->
        <div class="card" id="ownerStatsSection">
            <div class="section-title" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                <span style="font-size: 3rem; cursor: pointer; line-height: 1;" id="statsAvatar" onclick="openProfileEditor()" title="Click to change emoji">üë§</span>
                <div style="flex: 1;">
                    <span id="statsProfileName" style="font-size: 1.25rem;">Builder</span>
                    <button id="editProfileBtn" onclick="openProfileEditor()" style="
                        background: transparent;
                        border: none;
                        cursor: pointer;
                        font-size: 0.9rem;
                        opacity: 0.6;
                        margin-left: 8px;
                        padding: 4px 8px;
                        border-radius: 4px;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.opacity='1'; this.style.background='rgba(255,255,255,0.1)'" 
                       onmouseout="this.style.opacity='0.6'; this.style.background='transparent'"
                       title="Edit profile name">‚úèÔ∏è</button>
                    <span id="statsProfileAddress" style="font-size: 0.8rem; opacity: 0.6; font-family: 'Courier New', monospace; display: block;">Loading...</span>
                </div>
            </div>
            <div class="stats-grid" id="ownerStats">
                <div class="stat-card">
                    <div class="stat-value" id="followerCount">0</div>
                    <div class="stat-label">Verified Followers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgScore">0</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="yourScore">0</div>
                    <div class="stat-label">Your Score</div>
                </div>
            </div>
            
            <!-- Blockchain Stats -->
            <div class="stats-grid" style="margin-top: 16px;">
                <div class="stat-card">
                    <div class="stat-value" id="identityStatus"><span class="spinner"></span></div>
                    <div class="stat-label">Identity NFT Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="blockchainScore"><span class="spinner"></span></div>
                    <div class="stat-label">Blockchain Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="syncStatus"><span class="spinner"></span></div>
                    <div class="stat-label">Sync Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="blockchainHealth"><span class="spinner"></span></div>
                    <div class="stat-label">Blockchain Health</div>
                </div>
            </div>
        </div>

        <!-- ===== OPTIONAL PROFILE NFT SECTION ===== -->
        <div class="card" id="profileNftSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">üé® Optional Identity Display NFT</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('profileNftContent')">‚ñº</button>
            </div>
            
            <div id="profileNftContent" class="collapsible-content collapsed">
            <!-- Explanation Banner -->
            <div class="profile-nft-info" style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
                <p style="font-size: 0.9rem; opacity: 0.8; margin: 0;">
                    ‚ÑπÔ∏è This is an <strong>optional extension</strong>. Your AEra identity works fully without this NFT.
                    <br><span style="font-size: 0.8rem; opacity: 0.7;">This NFT controls public visibility on OpenSea and other marketplaces.</span>
                </p>
            </div>

            <!-- Profile NFT Status -->
            <div id="profileNftStatus">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Checking Profile NFT status...</span>
                </div>
            </div>

            <!-- Profile NFT Not Minted State -->
            <div id="profileNftNotMinted" style="display: none;">
                <div class="stats-grid" style="grid-template-columns: 1fr;">
                    <div class="stat-card" style="text-align: left;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2.5rem;">üñºÔ∏è</div>
                            <div>
                                <div class="stat-label" style="margin-bottom: 0.25rem;">Status</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Not Minted</div>
                            </div>
                        </div>
                        <p style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 1.5rem; line-height: 1.6;">
                            Mint your optional Profile NFT to display your verified identity on OpenSea and other NFT marketplaces. 
                            You decide if your profile is public or private.
                        </p>
                        <button class="profile-nft-btn mint-btn" id="mintProfileBtn" onclick="mintProfileNFT()">
                            <span class="btn-icon">‚ú®</span> Mint Profile NFT
                        </button>
                        <p style="font-size: 0.75rem; opacity: 0.5; margin-top: 0.75rem; text-align: center;">
                            Requires wallet signature for confirmation. Gas fees covered by AEra.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Profile NFT Minted State -->
            <div id="profileNftMinted" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Token ID</div>
                        <div class="stat-value" id="profileNftTokenId">#‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Visibility</div>
                        <div class="stat-value" id="profileNftVisibility">‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Soulbound</div>
                        <div class="stat-value" id="profileNftSoulbound">‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Marketplace</div>
                        <div class="stat-value">
                            <a href="#" id="profileNftOpenSeaLink" target="_blank" style="color: var(--secondary); text-decoration: none; font-size: 0.9rem;">
                                View on OpenSea ‚Üí
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Profile NFT Controls -->
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(99, 102, 241, 0.2);">
                    <h4 style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 1rem;">‚öôÔ∏è Profile Settings</h4>
                    
                    <!-- Visibility Toggle -->
                    <div class="profile-nft-control" style="display: flex; justify-content: space-between; align-items: center; background: rgba(0, 212, 255, 0.05); border-radius: 10px; padding: 1rem; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Public Metadata Visibility</div>
                            <div style="font-size: 0.75rem; opacity: 0.6; margin-top: 0.25rem;" id="visibilityToggleHint">Show your profile details on OpenSea</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="visibilityToggle" onchange="toggleProfileVisibility()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Delegate Setup Option (shown when backend is NOT delegate) -->
                    <div id="delegateSetupNotice" style="display: none; background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 10px; padding: 1rem; margin-bottom: 0.75rem;">
                        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                            <div style="font-size: 1.2rem;">üí°</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 0.85rem; color: var(--success);">Tip: Enable Free Toggle</div>
                                <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">
                                    One-time (~$0.001): Allow AEra to change your visibility for free.
                                </div>
                                <button class="cta-button cta-success-small" id="setupDelegateBtn" onclick="setupBackendDelegate()">
                                    ‚ö° Enable Free Toggle
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 1rem;">
                        <button class="cta-button cta-secondary-small" onclick="refreshMetadata()">
                            üîÑ Refresh Metadata
                        </button>
                        <button class="cta-button cta-danger-small" onclick="confirmBurnNft()">
                            üî• Remove NFT
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile NFT Minting State -->
            <div id="profileNftMinting" style="display: none;">
                <div style="text-align: center; padding: 2rem;">
                    <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto 1rem;"></div>
                    <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Minting your Profile NFT...</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">This may take a few seconds</div>
                </div>
            </div>
            </div>
        </div>

        <!-- ===== FOLLOWER LINK GENERATION SECTION ===== -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">üì§ Share Your Follower Link</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('followerLinkContent')">‚ñº</button>
            </div>
            <p style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1rem;">Generate a custom link to share with your followers on social media</p>
            
            <div id="followerLinkContent" class="collapsible-content collapsed">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Select Platform:</label>
                        <select id="platformSelect" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                            <option value="direct">‚ö° Direct Link</option>
                            <option value="twitter">ùïè X / Twitter</option>
                            <option value="reddit">ü§ñ Reddit</option>
                            <option value="telegram">‚úàÔ∏è Telegram</option>
                            <option value="discord">üí¨ Discord</option>
                            <option value="signal">üîí Signal</option>
                            <option value="slack">üí¨ Slack</option>
                            <option value="farcaster">üé≠ Farcaster</option>
                            <option value="whatsapp">üíö WhatsApp</option>
                            <option value="vk">üêª VK</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button class="cta-button cta-secondary-small" onclick="generateLink()" style="width: 100%;">Generate Link</button>
                    </div>
                </div>
                <div class="link-display" id="linkDisplay" style="display: none;">
                    <input type="text" id="generatedLink" readonly style="flex: 1; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                    <button class="cta-button cta-success-small" onclick="copyToClipboard()">Copy</button>
                </div>
            </div>
        </div>

        <!-- ===== NFT-GATED GROUP LINK SECTION ===== -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">üîê Your NFT-Gated Community Gate</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('nftGatedContent')">‚ñº</button>
            </div>
            <p style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1rem;">Configure your private community gate with secure one-time invite links</p>
            
            <!-- Security Status Badge -->
            <div id="gateSecurityStatus" style="margin-bottom: 1rem; padding: 12px; border-radius: 8px; display: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="securityIcon" style="font-size: 1.5rem;"></span>
                    <div>
                        <div id="securityLevel" style="font-weight: 600;"></div>
                        <div id="securityDescription" style="font-size: 0.85rem; opacity: 0.8;"></div>
                    </div>
                </div>
            </div>
            
            <div id="nftGatedContent" class="collapsible-content collapsed">
                
                <!-- Security Mode Selection -->
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--secondary);">ÔøΩÔ∏è Choose Security Mode</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div id="modeBasic" class="security-mode-card" onclick="selectSecurityMode('basic')" style="padding: 16px; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">üîó</div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Basic (Static Link)</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">Use a static invite link. Easy to set up, but links can be shared.</div>
                            <div style="margin-top: 8px; font-size: 0.75rem; color: #f59e0b;">‚ö†Ô∏è Less Secure</div>
                        </div>
                        <div id="modeAdvanced" class="security-mode-card" onclick="selectSecurityMode('advanced')" style="padding: 16px; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">ü§ñ</div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Advanced (Your Bot)</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">Use your own bot for true one-time links. Maximum security!</div>
                            <div style="margin-top: 8px; font-size: 0.75rem; color: #10b981;">‚úÖ Recommended</div>
                        </div>
                    </div>
                </div>
                
                <!-- Basic Mode: Static Link Configuration -->
                <div id="basicModeConfig" style="display: none; margin-bottom: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--secondary);">üîß Configure Static Group Link</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <div>
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Select Platform:</label>
                            <select id="gateplatformSelect" onchange="showPlatformWarning()" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                                <optgroup label="‚≠ê Recommended for NFT-Gating">
                                    <option value="telegram">‚úàÔ∏è Telegram (Best for communities)</option>
                                    <option value="discord">üí¨ Discord (Ideal for Web3)</option>
                                    <option value="signal">üîí Signal (Privacy-focused)</option>
                                </optgroup>
                                <optgroup label="‚úÖ Also Supported">
                                    <option value="slack">üí¨ Slack (Professional)</option>
                                    <option value="farcaster">üé≠ Farcaster (Web3-native)</option>
                                    <option value="vk">üêª VK</option>
                                </optgroup>
                                <optgroup label="‚ö†Ô∏è Limited Support">
                                    <option value="whatsapp">üíö WhatsApp (Max 1024 members)</option>
                                </optgroup>
                            </select>
                            <div id="platformWarning" style="display: none; margin-top: 8px; padding: 8px; background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; border-radius: 4px; font-size: 11px; color: #FFA500;"></div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Group Name (optional):</label>
                            <input type="text" id="privateGroupName" placeholder="My Private Group" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Group Invite Link:</label>
                            <input type="text" id="privateGroupInviteLink" placeholder="https://t.me/+ABC123..." style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                        </div>
                    </div>
                    <button class="cta-button cta-secondary-small" onclick="savePrivateGroup()" style="width: 100%;">üíæ Save Static Link Configuration</button>
                    <div id="privateGroupConfigStatus" style="margin-top: 8px; font-size: 12px; display: none;"></div>
                </div>
                
                <!-- Advanced Mode: Bot Configuration -->
                <div id="advancedModeConfig" style="display: none; margin-bottom: 20px;">
                    <!-- Platform Selection for Bot -->
                    <div style="padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 12px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--secondary);">ü§ñ Configure Your Own Bot</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div>
                                <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Platform:</label>
                                <select id="botPlatformSelect" onchange="updateBotInstructions()" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                                    <option value="telegram">‚úàÔ∏è Telegram</option>
                                    <option value="discord">üí¨ Discord</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Group Name:</label>
                                <input type="text" id="botGroupName" placeholder="My Private Community" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step-by-Step Bot Setup -->
                    <div style="padding: 16px; background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; margin-bottom: 12px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #10b981;">üìã Setup Steps</h4>
                        
                        <!-- Step 1: Create Bot -->
                        <div class="setup-step" style="margin-bottom: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <span style="background: var(--secondary); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">1</span>
                                <span style="font-weight: 600;">Create your Bot</span>
                            </div>
                            <div id="createBotInstructions" style="font-size: 0.85rem; opacity: 0.8; padding-left: 34px;">
                                <p style="margin: 0 0 8px 0;"><strong>Telegram:</strong></p>
                                <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Open Telegram and search for <a href="https://t.me/BotFather" target="_blank" style="color: var(--secondary);">@BotFather</a></li>
                                    <li>Send <code>/newbot</code> and follow the prompts</li>
                                    <li>Copy the API token you receive</li>
                                </ol>
                            </div>
                        </div>
                        
                        <!-- Step 2: Enter Token -->
                        <div class="setup-step" style="margin-bottom: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <span style="background: var(--secondary); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">2</span>
                                <span style="font-weight: 600;">Enter Bot Token</span>
                            </div>
                            <div style="padding-left: 34px;">
                                <input type="password" id="botTokenInput" placeholder="123456789:AABBccDDeeFF..." style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light); margin-bottom: 8px; font-family: monospace;">
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <button onclick="toggleBotTokenVisibility()" style="background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: var(--light); padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">üëÅÔ∏è Show/Hide</button>
                                </div>
                                <p style="font-size: 0.75rem; color: #f59e0b; margin: 8px 0 0 0;">üîí Your token is encrypted before storage!</p>
                            </div>
                        </div>
                        
                        <!-- Step 3: Add Bot to Group -->
                        <div class="setup-step" style="margin-bottom: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <span style="background: var(--secondary); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">3</span>
                                <span style="font-weight: 600;">Add Bot to your Group as Admin</span>
                            </div>
                            <div style="padding-left: 34px;">
                                <!-- Instructions for Detect Groups -->
                                <div style="margin-bottom: 12px; padding: 10px; background: rgba(0, 136, 204, 0.1); border: 1px dashed rgba(0, 136, 204, 0.4); border-radius: 6px;">
                                    <p style="font-size: 0.85rem; margin: 0 0 8px 0; color: #60a5fa; font-weight: 600;">üìã Before detecting your group:</p>
                                    <ol style="margin: 0; padding-left: 20px; font-size: 0.8rem; line-height: 1.8; opacity: 0.9;">
                                        <li>Open your Telegram group</li>
                                        <li>Add your bot as <strong>Administrator</strong> (with "Invite Users" permission)</li>
                                        <li>Send any message in the group (e.g. "hello") ‚Äî <em>this is required!</em></li>
                                        <li>Click the <strong>üîç Detect Groups</strong> button below</li>
                                    </ol>
                                </div>
                                
                                <!-- Detect Groups Button -->
                                <div style="margin-bottom: 12px;">
                                    <button onclick="detectTelegramGroups()" id="detectGroupsBtn" style="background: linear-gradient(135deg, #0088cc, #006699); border: none; color: white; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; font-weight: 600;">
                                        üîç Detect Groups
                                    </button>
                                </div>
                                
                                <!-- Detected Groups Dropdown (hidden initially) -->
                                <div id="detectedGroupsContainer" style="display: none; margin-bottom: 12px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px;">
                                    <label style="display: block; font-size: 11px; margin-bottom: 5px; color: #10b981; font-weight: 600;">‚úÖ Groups Found - Select one:</label>
                                    <select id="detectedGroupsSelect" onchange="selectDetectedGroup()" style="width: 100%; padding: 10px; border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.1); color: var(--light); cursor: pointer;">
                                        <option value="">-- Select a group --</option>
                                    </select>
                                </div>
                                
                                <!-- Manual Group ID Input -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <label style="display: block; font-size: 11px; margin-bottom: 5px; color: rgba(240, 244, 255, 0.7);">Group/Server ID:</label>
                                        <input type="text" id="botGroupId" placeholder="-1001234567890" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light); font-family: monospace;">
                                    </div>
                                    <div id="channelIdField" style="display: none;">
                                        <label style="display: block; font-size: 11px; margin-bottom: 5px; color: rgba(240, 244, 255, 0.7);">Channel ID (Discord):</label>
                                        <input type="text" id="botChannelId" placeholder="1234567890" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light); font-family: monospace;">
                                    </div>
                                </div>
                                <p style="font-size: 0.75rem; opacity: 0.7; margin: 8px 0 0 0;" id="groupIdHelp">üí° Or add <a href="https://t.me/getmyid_bot" target="_blank" style="color: var(--secondary);">@getmyid_bot</a> to your group to get the ID manually</p>
                            </div>
                        </div>
                        
                        <!-- Step 4: Fallback Static Link (Optional with Bot Token) -->
                        <div class="setup-step" style="margin-bottom: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <span style="background: rgba(255, 255, 255, 0.2); color: var(--light); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">4</span>
                                <span style="font-weight: 600;">Fallback Static Link <span id="fallbackRequired" style="opacity: 0.6; font-weight: normal;">(optional with Bot Token)</span></span>
                            </div>
                            <div style="padding-left: 34px;">
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="text" id="botFallbackLink" placeholder="https://t.me/+ABC123... (optional if Bot Token set)" style="flex: 1; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                                    <button onclick="generateInviteLink()" id="generateLinkBtn" style="padding: 10px 12px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 6px; color: white; font-size: 12px; cursor: pointer; white-space: nowrap;">üîó Auto-Generate</button>
                                </div>
                                <p style="font-size: 0.75rem; opacity: 0.7; margin: 8px 0 0 0;" id="fallbackLinkHelp">üí° Click "Auto-Generate" to let your bot create an invite link automatically</p>
                            </div>
                        </div>
                        
                        <!-- Step 5: Minimum Resonance Score -->
                        <div class="setup-step" style="margin-bottom: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <span style="background: linear-gradient(135deg, #a855f7, #6366f1); color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">5</span>
                                <span style="font-weight: 600;">Minimum Resonance Score</span>
                            </div>
                            <div style="padding-left: 34px;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <input type="range" id="minScoreSlider" min="50" max="200" value="50" 
                                           style="flex: 1; height: 8px; cursor: pointer; accent-color: var(--secondary);"
                                           oninput="updateScoreDisplay(this.value)">
                                    <div style="min-width: 80px; text-align: center;">
                                        <span id="minScoreValue" style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">50</span>
                                        <span style="font-size: 0.7rem; display: block; opacity: 0.7;">points</span>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; opacity: 0.6; margin-top: 4px;">
                                    <span>50 (Open)</span>
                                    <span>100</span>
                                    <span>150</span>
                                    <span>200 (Exclusive)</span>
                                </div>
                                <p style="font-size: 0.75rem; color: #a855f7; margin: 8px 0 0 0;" id="minScoreHint">
                                    üîì Open access - Users with any score can join
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Save & Verify Buttons -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button class="cta-button cta-secondary-small" onclick="saveBotConfiguration()" style="width: 100%;">üíæ Save Bot Configuration</button>
                        <button class="cta-button cta-success-small" onclick="verifyBotSetup()" id="verifyBotBtn" style="width: 100%;">‚úÖ Verify Bot Permissions</button>
                    </div>
                    <div id="botConfigStatus" style="margin-top: 12px; font-size: 12px; display: none; padding: 12px; border-radius: 6px;"></div>
                </div>
            
                <!-- Generate & Share Link -->
                <div style="margin-bottom: 15px;">
                    <button class="cta-button cta-secondary-small" onclick="generateGateLink()" style="width: 100%;">üîê Generate NFT-Gated Link</button>
                </div>
                <div class="link-display" id="gateLinkDisplay" style="display: none;">
                    <input type="text" id="generatedGateLink" readonly style="flex: 1; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                    <button class="cta-button cta-success-small" onclick="copyGateLink()">Copy</button>
                </div>
                <div id="gateStats" style="margin-top: 16px; padding: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; display: none;">
                    <p style="font-size: 13px; color: rgba(240, 244, 255, 0.7); margin: 0;">
                        <strong style="color: var(--secondary);">Access Statistics:</strong> 
                        <span id="gateInviteCount">0</span> users joined via your link
                        <span id="gateGroupInfo" style="display: block; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.15);"></span>
                    </p>
                </div>
                
                <!-- ===== CONFIGURED GATES OVERVIEW ===== -->
                <div id="configuredGatesSection" style="margin-top: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="margin: 0; font-size: 14px; color: var(--secondary);">üìã Your Configured Gates</h4>
                        <button class="cta-button cta-secondary-small" onclick="loadConfiguredGates()" style="padding: 5px 10px; font-size: 11px;">üîÑ Refresh</button>
                    </div>
                    <div id="configuredGatesList">
                        <div style="text-align: center; padding: 20px; color: rgba(240, 244, 255, 0.5);">
                            <p style="margin: 0;">Loading your gates...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Delete Confirmation Modal -->
                <div id="deleteGateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; justify-content: center; align-items: center;">
                    <div style="background: var(--dark-gradient); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 24px; max-width: 400px; width: 90%;">
                        <h3 style="margin: 0 0 12px 0; color: #ef4444;">‚ö†Ô∏è Delete Gate?</h3>
                        <p style="font-size: 14px; opacity: 0.8; margin-bottom: 8px;">
                            Are you sure you want to delete the gate <strong id="deleteGateName"></strong>?
                        </p>
                        <p style="font-size: 12px; color: #f59e0b; margin-bottom: 20px;">
                            This action cannot be undone. The bot token will be permanently deleted.
                        </p>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="closeDeleteModal()" style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; color: var(--light); cursor: pointer;">Cancel</button>
                            <button onclick="confirmDeleteGate()" style="flex: 1; padding: 12px; background: #ef4444; border: none; border-radius: 6px; color: white; cursor: pointer; font-weight: 600;">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- ===== SDK INTEGRATION SECTION ===== -->
        <div class="card" id="sdkAppsSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">üîß SDK Integration - Register Your Website</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('sdkContent')">‚ñº</button>
            </div>
            <p style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1rem;">Register your website to use AEra Gate authentication. Get your Client ID and Secret to integrate NFT-gated access on any website.</p>
            
            <div id="sdkContent" class="collapsible-content collapsed">
                <!-- Register New App Form -->
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--secondary);">‚ûï Register New Website</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <div>
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">App Name *</label>
                            <input type="text" id="sdkAppName" placeholder="My Awesome Website" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Website URL *</label>
                            <input type="text" id="sdkWebsiteUrl" placeholder="https://yourwebsite.com" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                        </div>
                    </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div>
                        <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Redirect URI *</label>
                        <input type="text" id="sdkRedirectUri" placeholder="https://yourwebsite.com/callback" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; color: rgba(240, 244, 255, 0.7);">Description (optional)</label>
                        <input type="text" id="sdkAppDescription" placeholder="Brief description of your app" style="width: 100%; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; font-size: 13px; background: rgba(255, 255, 255, 0.05); color: var(--light);">
                    </div>
                </div>
                <button class="cta-button cta-secondary-small" onclick="registerSdkApp()" style="width: 100%;">üöÄ Register App & Get Credentials</button>
                <div id="registerAppStatus" style="margin-top: 10px; display: none;"></div>
            </div>
            
            <!-- New Credentials Display (shown after registration) -->
            <div id="newCredentialsDisplay" style="display: none; margin-bottom: 20px; padding: 16px; background: rgba(16, 185, 129, 0.1); border: 2px solid var(--success); border-radius: 8px;">
                <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--success);">‚úÖ App Registered Successfully!</h4>
                <div style="background: rgba(5, 8, 20, 0.8); padding: 12px; border-radius: 6px; margin-bottom: 10px;">
                    <div style="margin-bottom: 8px;">
                        <label style="font-size: 11px; color: rgba(240, 244, 255, 0.6); display: block;">CLIENT ID:</label>
                        <code id="newClientId" style="font-size: 13px; color: var(--secondary); word-break: break-all;"></code>
                    </div>
                    <div>
                        <label style="font-size: 11px; color: rgba(240, 244, 255, 0.6); display: block;">CLIENT SECRET:</label>
                        <code id="newClientSecret" style="font-size: 13px; color: #f59e0b; word-break: break-all;"></code>
                    </div>
                </div>
                <p style="font-size: 12px; color: #f59e0b; margin: 0;">‚ö†Ô∏è <strong>IMPORTANT:</strong> Copy your Client Secret NOW! It will NOT be shown again.</p>
                <button class="cta-button cta-success-small" onclick="copyCredentials()" style="margin-top: 10px;">üìã Copy Both to Clipboard</button>
            </div>
            
            <!-- My Apps List -->
            <div id="myAppsSection" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h4 style="margin: 0; font-size: 14px; color: var(--secondary);">üì± My Registered Apps</h4>
                    <button class="cta-button cta-secondary-small" onclick="loadMyApps()" style="padding: 5px 10px; font-size: 11px;">üîÑ Refresh</button>
                </div>
                <div id="myAppsList" style="display: grid; gap: 12px;">
                    <div style="text-align: center; padding: 30px; color: rgba(240, 244, 255, 0.5);">
                        <p>Loading your registered apps...</p>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- ===== FOLLOWERS TABLE SECTION ===== -->
        <div class="card" id="followersSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">üåÄ Your Followers</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('followersTable')">‚ñº</button>
            </div>
            <p id="followerCount2" style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 1rem;">0 verified followers</p>
            
            <!-- Platform Filter -->
            <div class="filter-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 1rem;">
                <span style="font-size: 12px; color: var(--light); opacity: 0.7; margin-right: 8px;">Filter by Platform:</span>
                <button class="filter-btn active" data-platform="all" onclick="filterByPlatform('all')">All</button>
                <button class="filter-btn" data-platform="twitter" onclick="filterByPlatform('twitter')">üê¶ Twitter</button>
                <button class="filter-btn" data-platform="telegram" onclick="filterByPlatform('telegram')">‚úàÔ∏è Telegram</button>
                <button class="filter-btn" data-platform="discord" onclick="filterByPlatform('discord')">üéÆ Discord</button>
                <button class="filter-btn" data-platform="facebook" onclick="filterByPlatform('facebook')">üëç Facebook</button>
                <button class="filter-btn" data-platform="reddit" onclick="filterByPlatform('reddit')">ü§ñ Reddit</button>
                <button class="filter-btn" data-platform="direct" onclick="filterByPlatform('direct')">üîó Direct</button>
            </div>
            
            <!-- Followers Table -->
            <div id="followersTable" class="collapsible-content collapsed">
                <div id="followersContainer">
                    <div style="text-align: center; padding: 40px; color: rgba(240, 244, 255, 0.5);">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px;">Loading followers...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== BLOCKCHAIN INTERACTION HISTORY SECTION ===== -->
        <div class="card" id="interactionHistorySection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="section-title" style="margin-bottom: 0;">‚õìÔ∏è Blockchain Interaction History</h3>
                <button class="collapse-btn collapsed" onclick="toggleCollapse('interactionsTable')">‚ñº</button>
            </div>
            <p id="interactionCount" style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 1rem;">Loading...</p>
            
            <div id="interactionsTable" class="collapsible-content collapsed">
                <div id="interactionsContainer">
                    <div style="text-align: center; padding: 40px; color: rgba(240, 244, 255, 0.5);">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px;">Loading blockchain data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Living Feed Section - AUSKOMMENTIERT
        <div class="card">
            <h3 class="section-title">üì∞ Latest Updates</h3>
            <div id="feedContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading updates...</span>
                </div>
            </div>
        </div>
        -->

    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 AEra LogIn ‚Äî VEra-Resonance Project</p>
        <p style="margin-top: 0.5rem;">
            <a href="/privacy-policy">Privacy Policy</a> ¬∑ 
            <a href="/security-concept.html">Security</a>
        </p>
    </footer>

    <!-- ===== AERA CHAT WIDGET ===== -->
    <link rel="stylesheet" href="/aera-chat.css?v=20251209002">
    <script src="/aera-chat.js?v=20251209001"></script>
    <script>
        // Initialize AEra Chat Widget
        if (typeof initAeraChat === 'function') {
            initAeraChat();
            console.log('üåÄ AEra Chat Widget initialized');
        }
    </script>

    <!-- Scripts -->
    <script>
        // ========================================
        // AERA USER DASHBOARD - MAIN LOGIC
        // ========================================
        
        const API_BASE = '';
        let connectedWallet = null;
        let userNFTData = null;
        
        // Project Update Feed (loaded from backend or static)
        const feedData = [
            {
                id: 1,
                title: "AEra Gate SDK Infrastructure Live",
                badge: "integration",
                timestamp: "Dec 20, 2025",
                content: "Complete SDK infrastructure deployed: New server endpoints for authentication and NFT verification added, comprehensive SDK documentation portal launched at /sdk-docs with integration guides and code examples, developer resources including basic-integration demo with live authentication testing available.",
                link: "/sdk-docs"
            },
            {
                id: 2,
                title: "Android Intent-Bridge Live",
                badge: "integration",
                timestamp: "Dec 19, 2025",
                content: "AEra now supports direct Telegram access from Android wallet browsers including MetaMask Mobile, Base Wallet, and Trust Wallet.",
                link: null
            },
            {
                id: 3,
                title: "EIP-1271 Smart Contract Wallet Support",
                badge: "security",
                timestamp: "Dec 18, 2025",
                content: "Added full support for Smart Contract Wallets including Base Wallet and Coinbase Smart Wallet signature verification via isValidSignature().",
                link: null
            },
            {
                id: 4,
                title: "iOS Universal Links Enabled",
                badge: "update",
                timestamp: "Dec 17, 2025",
                content: "Improved iOS Telegram integration with Universal Links support for seamless deep linking from wallet browsers.",
                link: null
            },
            {
                id: 5,
                title: "Multi-Wallet Signature Support",
                badge: "update",
                timestamp: "Dec 15, 2025",
                content: "AEra supports signature verification across MetaMask, Rainbow, Trust Wallet, Base Wallet, and Coinbase Wallet with automatic fallback strategies.",
                link: null
            },
            {
                id: 6,
                title: "BASE Mainnet Deployment",
                badge: "integration",
                timestamp: "Dec 10, 2025",
                content: "AEra Identity NFT and Resonance Registry contracts are now live on BASE Mainnet (Chain ID: 8453).",
                link: null
            }
        ];

        // ========================================
        // MOBILE MENU FUNCTIONS
        // ========================================
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuBackdrop = document.getElementById('menuBackdrop');

        function toggleMenu() {
            mobileMenu.classList.toggle('active');
            menuBackdrop.classList.toggle('active');
            
            // Change icon
            if (mobileMenu.classList.contains('active')) {
                menuToggle.textContent = '‚úï';
            } else {
                menuToggle.textContent = '‚ò∞';
            }
        }

        function closeMenu() {
            mobileMenu.classList.remove('active');
            menuBackdrop.classList.remove('active');
            menuToggle.textContent = '‚ò∞';
        }

        // Toggle menu on button click
        menuToggle.addEventListener('click', toggleMenu);

        // Close menu on backdrop click
        menuBackdrop.addEventListener('click', closeMenu);

        // Close menu on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
                closeMenu();
            }
        });

        // ========================================
        // BACKGROUND PARTICLES
        // ========================================
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // ========================================
        // PROFILE NFT FUNCTIONS
        // ========================================
        let profileNFTData = null;
        
        /**
         * Robust wallet signing with multiple fallback strategies
         * Handles different wallet implementations (MetaMask, Coinbase, Base, Rainbow, etc.)
         */
        async function robustWalletSign(message, address) {
            console.log('üîê Requesting wallet signature...');
            
            // STRATEGY 1: Standard personal_sign [message, address]
            try {
                console.log('üìù Trying standard personal_sign [message, address]...');
                const signature = await window.ethereum.request({
                    method: 'personal_sign',
                    params: [message, address]
                });
                if (signature) {
                    console.log('‚úÖ Standard personal_sign successful!');
                    return signature;
                }
            } catch (error1) {
                console.log(`‚ö†Ô∏è Standard method failed: ${error1.message}`);
                
                // STRATEGY 2: Reversed params [address, message]
                try {
                    console.log('üîÑ Trying reversed personal_sign [address, message]...');
                    const signature = await window.ethereum.request({
                        method: 'personal_sign',
                        params: [address, message]
                    });
                    if (signature) {
                        console.log('‚úÖ Reversed personal_sign successful!');
                        return signature;
                    }
                } catch (error2) {
                    console.log(`‚ö†Ô∏è Reversed method failed: ${error2.message}`);
                    
                    // STRATEGY 3: Hex-encoded message
                    try {
                        console.log('üî¢ Trying hex-encoded personal_sign...');
                        const hexMessage = '0x' + Array.from(new TextEncoder().encode(message))
                            .map(b => b.toString(16).padStart(2, '0')).join('');
                        const signature = await window.ethereum.request({
                            method: 'personal_sign',
                            params: [hexMessage, address]
                        });
                        if (signature) {
                            console.log('‚úÖ Hex-encoded personal_sign successful!');
                            return signature;
                        }
                    } catch (error3) {
                        console.log(`‚ùå All signature methods failed`);
                        throw new Error(`Signature rejected: ${error1.message}`);
                    }
                }
            }
            
            throw new Error('No signature received');
        }

        async function loadProfileNFTStatus() {
            if (!connectedWallet) return;
            
            try {
                console.log('üé® Loading Profile NFT status...');
                const response = await fetch(`${API_BASE}/api/profile-nft/status/${connectedWallet}`);
                const data = await response.json();
                
                console.log('üé® Profile NFT status:', data);
                profileNFTData = data;
                
                // Hide loading state
                const statusDiv = document.getElementById('profileNftStatus');
                if (statusDiv) statusDiv.style.display = 'none';
                
                const notMintedDiv = document.getElementById('profileNftNotMinted');
                const mintedDiv = document.getElementById('profileNftMinted');
                
                if (!notMintedDiv || !mintedDiv) return;
                
                if (data.has_profile_nft) {
                    // User has Profile NFT
                    notMintedDiv.style.display = 'none';
                    mintedDiv.style.display = 'block';
                    
                    // Update status display
                    document.getElementById('profileNftTokenId').textContent = `#${data.token_id}`;
                    
                    const visibilityEl = document.getElementById('profileNftVisibility');
                    if (data.is_public) {
                        visibilityEl.textContent = 'PUBLIC';
                        visibilityEl.className = 'stat-value public';
                        visibilityEl.style.color = 'var(--success)';
                    } else {
                        visibilityEl.textContent = 'PRIVATE';
                        visibilityEl.className = 'stat-value private';
                        visibilityEl.style.color = 'var(--warning)';
                    }
                    
                    // Update soulbound status
                    const soulboundEl = document.getElementById('profileNftSoulbound');
                    if (soulboundEl) soulboundEl.textContent = 'Yes';
                    
                    // Update toggle state
                    const toggle = document.getElementById('visibilityToggle');
                    if (toggle) toggle.checked = data.is_public;
                    
                    // Update OpenSea link
                    const openseaLink = document.getElementById('profileNftOpenSeaLink');
                    if (openseaLink) {
                        openseaLink.href = `https://opensea.io/assets/base/0x0a630A3Dc0C7387e0226D1b285C43B753506b27E/${data.token_id}`;
                    }
                    
                    // Show/hide delegate setup notice & update hint
                    const delegateNotice = document.getElementById('delegateSetupNotice');
                    const toggleHint = document.getElementById('visibilityToggleHint');
                    if (delegateNotice) {
                        if (data.backend_is_delegate) {
                            delegateNotice.style.display = 'none';
                            if (toggleHint) toggleHint.textContent = '‚úÖ Free toggle (Delegate active)';
                        } else {
                            delegateNotice.style.display = 'block';
                            if (toggleHint) toggleHint.textContent = 'üí≥ You pay gas (~$0.001 per change)';
                        }
                    }
                    
                    // Store delegate status
                    profileNFTData.backend_is_delegate = data.backend_is_delegate;
                    profileNFTData.backend_address = data.backend_address;
                } else {
                    // User doesn't have Profile NFT
                    notMintedDiv.style.display = 'block';
                    mintedDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('‚ùå Error loading Profile NFT status:', error);
            }
        }
        
        async function mintProfileNFT() {
            const btn = document.getElementById('mintProfileBtn');
            if (!btn || !connectedWallet) {
                alert('‚ùå Keine Wallet verbunden');
                return;
            }
            
            // Check if ethereum is available
            if (typeof window.ethereum === 'undefined') {
                alert('‚ùå Keine Web3 Wallet gefunden. Bitte MetaMask, Coinbase Wallet oder eine andere Web3 Wallet installieren.');
                return;
            }
            
            const originalText = btn.innerHTML;
            
            try {
                // Step 1: Request wallet signature for confirmation
                btn.disabled = true;
                btn.innerHTML = '<span class="btn-icon">üîê</span> Bitte in Wallet best√§tigen...';
                
                const timestamp = Date.now();
                const message = `AEra Profile NFT Mint Request\n\nI authorize minting my AEra Profile NFT.\n\nWallet: ${connectedWallet}\nTimestamp: ${timestamp}\n\nThis is a signature request only - no gas fees will be charged.`;
                
                console.log('üîê Requesting wallet signature for Profile NFT mint...');
                
                let signature;
                try {
                    signature = await robustWalletSign(message, connectedWallet);
                } catch (signError) {
                    if (signError.message.includes('rejected') || signError.message.includes('denied') || signError.code === 4001) {
                        alert('‚ùå Signatur abgelehnt. Mint abgebrochen.');
                    } else {
                        alert(`‚ùå Signatur-Fehler: ${signError.message}`);
                    }
                    return;
                }
                
                console.log('‚úÖ Signature received:', signature.substring(0, 20) + '...');
                
                // Step 2: Send mint request with signature
                btn.innerHTML = '<span class="spinner" style="width:16px;height:16px;border-width:2px;"></span> Minting...';
                
                console.log('üé® Sending mint request to backend...');
                const response = await fetch(`${API_BASE}/api/profile-nft/mint`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        address: connectedWallet,
                        signature: signature,
                        message: message,
                        timestamp: timestamp
                    })
                });
                
                const data = await response.json();
                console.log('üé® Mint response:', data);
                
                if (data.success) {
                    alert(`‚úÖ Profile NFT erfolgreich geminted!\n\nToken ID: #${data.token_id}\nTransaction: ${data.tx_hash.substring(0, 20)}...\n\nDein Profile NFT wird in K√ºrze auf OpenSea sichtbar sein.`);
                    await loadProfileNFTStatus();
                } else {
                    alert(`‚ùå Mint fehlgeschlagen: ${data.error || 'Unbekannter Fehler'}`);
                }
            } catch (error) {
                console.error('‚ùå Mint error:', error);
                alert('‚ùå Verbindungsfehler beim Minting: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // Profile NFT Contract for setDelegate
        const PROFILE_NFT_ADDRESS = '0x0a630A3Dc0C7387e0226D1b285C43B753506b27E';
        const BACKEND_ADDRESS = '0x22A2cAcB19e77D25DA063A787870A3eE6BAC8Dfe';
        
        // Helper function to encode setDelegate(uint256 tokenId, address delegate)
        function encodeSetDelegate(tokenId, delegateAddress) {
            // Function selector: keccak256("setDelegate(uint256,address)") first 4 bytes = 0x94dcf2e6
            const selector = '0x94dcf2e6';
            
            // Encode tokenId as uint256 (32 bytes, padded)
            const tokenIdHex = tokenId.toString(16).padStart(64, '0');
            
            // Encode delegate address (remove 0x, pad to 32 bytes)
            const addressHex = delegateAddress.toLowerCase().replace('0x', '').padStart(64, '0');
            
            return selector + tokenIdHex + addressHex;
        }
        
        // Setup backend as delegate (one-time user transaction)
        async function setupBackendDelegate() {
            const btn = document.getElementById('setupDelegateBtn');
            if (!btn || !profileNFTData || !profileNFTData.token_id) {
                alert('‚ùå Kein Profile NFT gefunden');
                return;
            }
            
            if (typeof window.ethereum === 'undefined') {
                alert('‚ùå Keine Web3 Wallet gefunden');
                return;
            }
            
            const tokenId = profileNFTData.token_id;
            const originalText = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = '<span class="spinner" style="width:14px;height:14px;border-width:2px;"></span> Bitte best√§tigen...';
                
                console.log(`üîê Setting backend ${BACKEND_ADDRESS} as delegate for token #${tokenId}...`);
                
                // Encode the function call
                const data = encodeSetDelegate(tokenId, BACKEND_ADDRESS);
                
                // Request transaction from user's wallet
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: connectedWallet,
                        to: PROFILE_NFT_ADDRESS,
                        data: data,
                        chainId: '0x2105' // Base Mainnet (8453)
                    }]
                });
                
                console.log('üì§ Delegate TX sent:', txHash);
                alert(`‚úÖ Transaktion gesendet!\n\nTx: ${txHash.substring(0, 20)}...\n\nNach Best√§tigung kannst du die Visibility kostenlos √§ndern!`);
                
                // Wait for confirmation and reload status
                setTimeout(async () => {
                    await loadProfileNFTStatus();
                }, 5000);
                
            } catch (error) {
                console.error('‚ùå Delegate setup error:', error);
                
                if (error.code === 4001 || error.message?.includes('rejected')) {
                    alert('‚ùå Transaktion abgelehnt');
                } else {
                    alert(`‚ùå Fehler: ${error.message || 'Unbekannter Fehler'}`);
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // Helper function to encode setVisibility(uint256 tokenId, bool visibility)
        function encodeSetVisibility(tokenId, visibility) {
            // Function selector: keccak256("setVisibility(uint256,bool)") first 4 bytes = 0xe3f54d2d
            const selector = '0xe3f54d2d';
            const tokenIdHex = tokenId.toString(16).padStart(64, '0');
            const visibilityHex = visibility ? '0000000000000000000000000000000000000000000000000000000000000001' : '0000000000000000000000000000000000000000000000000000000000000000';
            return selector + tokenIdHex + visibilityHex;
        }
        
        // Toggle visibility - User chooses: FREE via backend OR self-pay
        async function toggleProfileVisibility() {
            const toggle = document.getElementById('visibilityToggle');
            if (!toggle || !profileNFTData || !profileNFTData.token_id) {
                alert('‚ùå Kein Profile NFT gefunden');
                return;
            }
            
            if (typeof window.ethereum === 'undefined') {
                alert('‚ùå Keine Web3 Wallet gefunden');
                toggle.checked = !toggle.checked;
                return;
            }
            
            const newVisibility = toggle.checked;
            const tokenId = profileNFTData.token_id;
            
            // If backend is delegate, use free backend transaction
            if (profileNFTData.backend_is_delegate) {
                try {
                    console.log(`üé® Setting visibility to ${newVisibility ? 'PUBLIC' : 'PRIVATE'} via backend (FREE)...`);
                    
                    const response = await fetch(`${API_BASE}/api/profile-nft/visibility`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            address: connectedWallet,
                            is_public: newVisibility
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        updateVisibilityUI(newVisibility);
                        profileNFTData.is_public = newVisibility;
                    } else {
                        throw new Error(data.error || 'Unknown error');
                    }
                } catch (error) {
                    console.error('‚ùå Backend visibility error:', error);
                    toggle.checked = !newVisibility;
                    alert(`‚ùå Fehler: ${error.message || 'Verbindungsfehler'}`);
                }
                return;
            }
            
            // Backend is NOT delegate - User pays directly
            try {
                console.log(`üé® Setting visibility to ${newVisibility ? 'PUBLIC' : 'PRIVATE'} via wallet (self-pay)...`);
                
                const data = encodeSetVisibility(tokenId, newVisibility);
                
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: connectedWallet,
                        to: PROFILE_NFT_ADDRESS,
                        data: data,
                        chainId: '0x2105' // Base Mainnet (8453)
                    }]
                });
                
                console.log('üì§ Transaction sent:', txHash);
                
                // Wait for TX confirmation, then sync visibility to backend DB
                setTimeout(async () => {
                    try {
                        // Sync the on-chain visibility to database
                        await fetch(`${API_BASE}/api/profile-nft/sync-visibility`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ address: connectedWallet })
                        });
                        console.log('‚úÖ Visibility synced to database');
                    } catch (syncError) {
                        console.warn('‚ö†Ô∏è Could not sync visibility to DB:', syncError);
                    }
                    await loadProfileNFTStatus();
                }, 8000);
                
            } catch (error) {
                console.error('‚ùå Visibility toggle error:', error);
                toggle.checked = !newVisibility;
                
                if (error.code === 4001 || error.message?.includes('rejected')) {
                    alert('‚ùå Transaktion abgelehnt');
                } else {
                    alert(`‚ùå Fehler: ${error.message || 'Unbekannter Fehler'}`);
                }
            }
        }
        
        // Helper to update visibility UI
        function updateVisibilityUI(isPublic) {
            const visibilityEl = document.getElementById('profileNftVisibility');
            if (visibilityEl) {
                if (isPublic) {
                    visibilityEl.textContent = 'PUBLIC';
                    visibilityEl.style.color = 'var(--success)';
                } else {
                    visibilityEl.textContent = 'PRIVATE';
                    visibilityEl.style.color = 'var(--warning)';
                }
            }
        }
        
        async function refreshProfileMetadata() {
            const btn = event.target.closest('button');
            if (!btn || !profileNFTData || !profileNFTData.token_id) return;
            
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner" style="width:14px;height:14px;border-width:2px;"></span>';
            
            try {
                console.log('üé® Refreshing Profile NFT metadata...');
                const response = await fetch(`${API_BASE}/api/profile-nft/refresh`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: connectedWallet })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Metadata-Refresh angefordert!\nOpenSea aktualisiert innerhalb von 1-24 Stunden.');
                } else {
                    alert(`‚ùå Fehler: ${data.error || 'Refresh fehlgeschlagen'}`);
                }
            } catch (error) {
                console.error('‚ùå Refresh error:', error);
                alert('‚ùå Verbindungsfehler');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        async function burnProfileNFT() {
            if (!profileNFTData || !profileNFTData.token_id) return;
            
            const confirmed = confirm(
                '‚ö†Ô∏è ACHTUNG: Profile NFT verbrennen?\n\n' +
                'Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!\n' +
                'Das NFT wird permanent zerst√∂rt.\n\n' +
                'Du kannst sp√§ter ein neues minten, falls gew√ºnscht.\n\n' +
                'Fortfahren?'
            );
            
            if (!confirmed) return;
            
            const btn = event.target.closest('button');
            if (!btn) return;
            
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner" style="width:14px;height:14px;border-width:2px;"></span> Burning...';
            
            try {
                console.log('üî• Burning Profile NFT...');
                const response = await fetch(`${API_BASE}/api/profile-nft/burn`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: connectedWallet })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Profile NFT wurde verbrannt.');
                    profileNFTData = null;
                    await loadProfileNFTStatus();
                } else {
                    alert(`‚ùå Fehler: ${data.error || 'Burn fehlgeschlagen'}`);
                }
            } catch (error) {
                console.error('‚ùå Burn error:', error);
                alert('‚ùå Verbindungsfehler');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // ========================================
        // FOLLOWER LINK FUNCTIONS
        // ========================================
        async function generateLink() {
            const platform = document.getElementById('platformSelect').value;
            const linkDisplay = document.getElementById('linkDisplay');
            const linkInput = document.getElementById('generatedLink');
            
            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/follower-link?owner=${connectedWallet}&source=${platform}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                linkInput.value = data.follower_link;
                linkDisplay.style.display = 'flex';
                
            } catch (error) {
                alert('Error generating link: ' + error.message);
            }
        }
        
        function copyToClipboard(text) {
            // If text is passed directly, copy it
            if (typeof text === 'string' && text.length > 0) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('success', 'üìã Link copied to clipboard!');
                }).catch(() => {
                    // Fallback for older browsers
                    const tempInput = document.createElement('input');
                    tempInput.value = text;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showNotification('success', 'üìã Link copied to clipboard!');
                });
                return;
            }
            
            // Fallback: copy from generatedLink input
            const linkInput = document.getElementById('generatedLink');
            linkInput.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copied!';
            setTimeout(() => btn.textContent = originalText, 2000);
        }

        // ========================================
        // NFT-GATED LINK FUNCTIONS
        // ========================================
        async function generateGateLink() {
            const linkDisplay = document.getElementById('gateLinkDisplay');
            const linkInput = document.getElementById('generatedGateLink');
            const statsDiv = document.getElementById('gateStats');
            
            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }
            
            try {
                const baseUrl = window.location.origin;
                const gateLink = `${baseUrl}/join-telegram?owner=${connectedWallet}`;
                
                linkInput.value = gateLink;
                linkDisplay.style.display = 'flex';
                
                // Fetch Gate Statistics from Backend
                const statsResponse = await fetch(`${API_BASE}/api/telegram-gate/stats/${connectedWallet}`);
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    document.getElementById('gateInviteCount').textContent = statsData.invite_count;
                    
                    const groupInfoDiv = document.getElementById('gateGroupInfo');
                    if (statsData.has_configured_group) {
                        groupInfoDiv.innerHTML = `
                            <strong>üîó Your Group:</strong> 
                            ${statsData.group_name || 'Unnamed Group'}<br>
                            <span style="font-size: 11px; opacity: 0.7;">${statsData.telegram_link}</span>
                        `;
                        
                        document.getElementById('privateGroupName').value = statsData.group_name || '';
                        document.getElementById('privateGroupInviteLink').value = statsData.telegram_link || '';
                    } else {
                        groupInfoDiv.innerHTML = `
                            <strong style="color: #f59e0b;">‚ö†Ô∏è No group configured yet</strong><br>
                            <span style="font-size: 11px;">Configure your group above to start using this gate link</span>
                        `;
                    }
                    
                    statsDiv.style.display = 'block';
                } else {
                    statsDiv.style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error generating gate link:', error);
                linkDisplay.style.display = 'flex';
            }
        }
        
        function showPlatformWarning() {
            const platform = document.getElementById('gateplatformSelect').value;
            const warningDiv = document.getElementById('platformWarning');
            
            const warnings = {
                'whatsapp': '‚ö†Ô∏è WhatsApp groups are limited to 1024 members maximum. Consider Telegram or Discord for larger communities.',
                'farcaster': '‚ÑπÔ∏è Farcaster is a decentralized social network. Make sure your community is familiar with Web3 platforms.',
                'slack': '‚ÑπÔ∏è Slack is great for professional communities but requires a workspace setup.'
            };
            
            if (warnings[platform]) {
                warningDiv.textContent = warnings[platform];
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
        }
        
        async function savePrivateGroup() {
            const platform = document.getElementById('gateplatformSelect').value;
            const groupName = document.getElementById('privateGroupName').value.trim();
            const inviteLink = document.getElementById('privateGroupInviteLink').value.trim();
            const statusDiv = document.getElementById('privateGroupConfigStatus');
            
            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }
            
            if (!inviteLink || !inviteLink.startsWith('https://')) {
                statusDiv.textContent = '‚ùå Invalid invite link. Must start with https://';
                statusDiv.style.color = '#ef4444';
                statusDiv.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/telegram-gate/set-group`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        owner: connectedWallet,
                        telegram_link: inviteLink,
                        group_name: groupName || `${platform} Group`,
                        platform: platform
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.textContent = '‚úÖ Group configured successfully!';
                    statusDiv.style.color = '#10b981';
                    statusDiv.style.display = 'block';
                    
                    setTimeout(() => generateGateLink(), 500);
                } else {
                    statusDiv.textContent = '‚ùå ' + (data.error || 'Failed to save configuration');
                    statusDiv.style.color = '#ef4444';
                    statusDiv.style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error saving private group:', error);
                statusDiv.textContent = '‚ùå Failed to save: ' + error.message;
                statusDiv.style.color = '#ef4444';
                statusDiv.style.display = 'block';
            }
        }
        
        function copyGateLink() {
            const linkInput = document.getElementById('generatedGateLink');
            linkInput.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copied!';
            setTimeout(() => btn.textContent = originalText, 2000);
        }
        
        // ========================================
        // MINIMUM SCORE SLIDER FUNCTIONS
        // ========================================
        function updateScoreDisplay(value) {
            const scoreValue = document.getElementById('minScoreValue');
            const scoreHint = document.getElementById('minScoreHint');
            
            scoreValue.textContent = value;
            
            // Update color based on score
            if (value <= 50) {
                scoreValue.style.color = '#10b981';  // Green - open
                scoreHint.innerHTML = 'üîì <strong>Open access</strong> - Users with any score can join';
                scoreHint.style.color = '#10b981';
            } else if (value <= 75) {
                scoreValue.style.color = '#22c55e';  // Light green
                scoreHint.innerHTML = 'üìä <strong>Basic threshold</strong> - New verified users can join';
                scoreHint.style.color = '#22c55e';
            } else if (value <= 100) {
                scoreValue.style.color = '#f59e0b';  // Yellow
                scoreHint.innerHTML = '‚≠ê <strong>Regular members</strong> - Some engagement required';
                scoreHint.style.color = '#f59e0b';
            } else if (value <= 150) {
                scoreValue.style.color = '#a855f7';  // Purple
                scoreHint.innerHTML = 'üíé <strong>Active community</strong> - Significant engagement needed';
                scoreHint.style.color = '#a855f7';
            } else {
                scoreValue.style.color = '#ffd700';  // Gold
                scoreHint.innerHTML = 'üëë <strong>VIP exclusive</strong> - Only top contributors can join';
                scoreHint.style.color = '#ffd700';
            }
        }

        // ========================================
        // ADVANCED GATE SERVICE FUNCTIONS
        // ========================================
        let currentSecurityMode = null;
        
        function selectSecurityMode(mode) {
            currentSecurityMode = mode;
            
            // Update visual selection
            document.getElementById('modeBasic').style.border = mode === 'basic' 
                ? '2px solid #f59e0b' 
                : '2px solid rgba(255, 255, 255, 0.1)';
            document.getElementById('modeBasic').style.background = mode === 'basic' 
                ? 'rgba(245, 158, 11, 0.1)' 
                : 'transparent';
                
            document.getElementById('modeAdvanced').style.border = mode === 'advanced' 
                ? '2px solid #10b981' 
                : '2px solid rgba(255, 255, 255, 0.1)';
            document.getElementById('modeAdvanced').style.background = mode === 'advanced' 
                ? 'rgba(16, 185, 129, 0.1)' 
                : 'transparent';
            
            // Show/hide configuration panels
            document.getElementById('basicModeConfig').style.display = mode === 'basic' ? 'block' : 'none';
            document.getElementById('advancedModeConfig').style.display = mode === 'advanced' ? 'block' : 'none';
        }
        
        function toggleBotTokenVisibility() {
            const input = document.getElementById('botTokenInput');
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        // =====================================================
        // AUTO-DETECT TELEGRAM GROUPS / DISCORD SERVERS
        // =====================================================
        async function detectTelegramGroups() {
            const platform = document.getElementById('botPlatformSelect').value;
            
            const botToken = document.getElementById('botTokenInput').value.trim();
            if (!botToken) {
                showToast('Please enter your Bot Token first', 'warning');
                return;
            }
            
            const btn = document.getElementById('detectGroupsBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Detecting...';
            btn.disabled = true;
            
            try {
                // Use different endpoint for Discord vs Telegram
                const endpoint = platform === 'discord' 
                    ? `${API_BASE}/api/gate/detect-discord-servers`
                    : `${API_BASE}/api/gate/detect-groups`;
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ bot_token: botToken })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('detectedGroupsContainer');
                    const select = document.getElementById('detectedGroupsSelect');
                    
                    // Handle Discord servers vs Telegram groups
                    const items = platform === 'discord' ? data.servers : data.groups;
                    const itemType = platform === 'discord' ? 'server' : 'group';
                    
                    if (items && items.length > 0) {
                        // Populate dropdown
                        select.innerHTML = `<option value="">-- Select a ${itemType} --</option>`;
                        items.forEach(item => {
                            const memberInfo = item.member_count ? ` (${item.member_count} members)` : '';
                            const option = document.createElement('option');
                            // Store platform info in JSON for selectDetectedGroup()
                            option.value = JSON.stringify({ ...item, _platform: platform });
                            
                            if (platform === 'discord') {
                                // Discord format: Server Name + channel info
                                const channelInfo = item.channels && item.channels.length > 0 
                                    ? ` [${item.channels.length} channels]` 
                                    : '';
                                option.textContent = `${item.name}${memberInfo}${channelInfo}`;
                            } else {
                                // Telegram format
                                option.textContent = `${item.group_name}${memberInfo} [${item.group_type}]`;
                            }
                            select.appendChild(option);
                        });
                        
                        container.style.display = 'block';
                        showToast(`‚úì Found ${items.length} ${itemType}(s)! Select one below.`, 'success');
                    } else {
                        container.style.display = 'none';
                        if (platform === 'discord') {
                            showToast(data.message || 'No servers found. Add bot to your Discord server first.', 'warning');
                        } else {
                            showToast(data.message || 'No groups found. Add bot to group and send a message first.', 'warning');
                        }
                    }
                } else {
                    showToast(data.error || 'Detection failed', 'error');
                }
            } catch (error) {
                console.error('Detect groups error:', error);
                showToast('Failed to detect: ' + error.message, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        function selectDetectedGroup() {
            const select = document.getElementById('detectedGroupsSelect');
            const selectedValue = select.value;
            
            if (!selectedValue) return;
            
            try {
                const item = JSON.parse(selectedValue);
                const platform = item._platform || 'telegram';
                
                if (platform === 'discord') {
                    // Discord: use guild_id and auto-select first channel
                    document.getElementById('botGroupId').value = item.guild_id;
                    
                    // Auto-fill channel ID if available
                    if (item.channels && item.channels.length > 0) {
                        const firstChannel = item.channels[0];
                        document.getElementById('botChannelId').value = firstChannel.id;
                    }
                    
                    // Auto-fill the Group Name field
                    const groupNameInput = document.getElementById('botGroupName');
                    if (groupNameInput) {
                        groupNameInput.value = item.name || '';
                    }
                    
                    showToast(`‚úì Selected: ${item.name}`, 'success');
                } else {
                    // Telegram: use group_id
                    document.getElementById('botGroupId').value = item.group_id;
                    
                    // Auto-fill the Group Name field if it exists and is empty
                    const groupNameInput = document.getElementById('botGroupName');
                    if (groupNameInput && !groupNameInput.value) {
                        groupNameInput.value = item.group_name || '';
                    }
                    
                    showToast(`‚úì Selected: ${item.group_name}`, 'success');
                }
                
                // Highlight the Group ID field briefly
                const groupIdInput = document.getElementById('botGroupId');
                groupIdInput.style.borderColor = '#22c55e';
                groupIdInput.style.boxShadow = '0 0 10px rgba(34, 197, 94, 0.3)';
                setTimeout(() => {
                    groupIdInput.style.borderColor = '';
                    groupIdInput.style.boxShadow = '';
                }, 2000);
                
            } catch (e) {
                console.error('Error parsing group:', e);
            }
        }
        
        // Auto-generate invite link using bot API (Telegram or Discord)
        async function generateInviteLink() {
            const platform = document.getElementById('botPlatformSelect').value;
            const botToken = document.getElementById('botTokenInput').value.trim();
            const groupId = document.getElementById('botGroupId').value.trim();
            const channelId = document.getElementById('botChannelId')?.value?.trim() || '';
            const btn = document.getElementById('generateLinkBtn');
            
            if (!botToken) {
                showToast('‚ùå Please enter Bot Token first', 'error');
                return;
            }
            
            if (!groupId) {
                showToast(`‚ùå Please enter or select ${platform === 'discord' ? 'Server' : 'Group'} ID first`, 'error');
                return;
            }
            
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Generating...';
            btn.disabled = true;
            
            try {
                // Use different endpoint for Discord vs Telegram
                let endpoint, requestBody;
                
                if (platform === 'discord') {
                    endpoint = '/api/gate/generate-discord-invite';
                    requestBody = {
                        bot_token: botToken,
                        guild_id: groupId,
                        channel_id: channelId || undefined
                    };
                } else {
                    endpoint = '/api/gate/generate-invite-link';
                    requestBody = {
                        bot_token: botToken,
                        group_id: groupId
                    };
                }
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (data.success && data.invite_link) {
                    // Auto-fill the fallback link field
                    document.getElementById('botFallbackLink').value = data.invite_link;
                    showToast('‚úÖ Invite link generated!', 'success');
                    
                    // Highlight the field
                    const linkInput = document.getElementById('botFallbackLink');
                    linkInput.style.borderColor = '#22c55e';
                    linkInput.style.boxShadow = '0 0 10px rgba(34, 197, 94, 0.3)';
                    setTimeout(() => {
                        linkInput.style.borderColor = '';
                        linkInput.style.boxShadow = '';
                    }, 2000);
                } else {
                    showToast(`‚ùå ${data.error || 'Failed to generate link'}`, 'error');
                    // Show helpful hint if permission error
                    if (data.error && (data.error.includes('administrator') || data.error.includes('permission'))) {
                        document.getElementById('fallbackLinkHelp').innerHTML = 
                            `‚ö†Ô∏è Bot needs ${platform === 'discord' ? '"Create Instant Invite"' : '"Invite Users"'} permission. You can still paste a link manually.`;
                    }
                }
            } catch (e) {
                console.error('Generate link error:', e);
                showToast('‚ùå Network error', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        function updateBotInstructions() {
            const platform = document.getElementById('botPlatformSelect').value;
            const instructionsDiv = document.getElementById('createBotInstructions');
            const channelField = document.getElementById('channelIdField');
            const groupIdHelp = document.getElementById('groupIdHelp');
            const detectBtn = document.getElementById('detectGroupsBtn');
            
            // Hide detected groups when switching platforms
            document.getElementById('detectedGroupsContainer').style.display = 'none';
            
            if (platform === 'telegram') {
                instructionsDiv.innerHTML = `
                    <p style="margin: 0 0 8px 0;"><strong>Telegram:</strong></p>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li>Open Telegram and search for <a href="https://t.me/BotFather" target="_blank" style="color: var(--secondary);">@BotFather</a></li>
                        <li>Send <code>/newbot</code> and follow the prompts</li>
                        <li>Copy the API token you receive</li>
                    </ol>
                `;
                channelField.style.display = 'none';
                detectBtn.style.display = 'flex';
                detectBtn.style.background = 'linear-gradient(135deg, #0088cc, #006699)';
                detectBtn.innerHTML = 'üîç Detect Groups';
                groupIdHelp.innerHTML = 'üí° Or add <a href="https://t.me/getmyid_bot" target="_blank" style="color: var(--secondary);">@getmyid_bot</a> to your group to get the ID manually';
                
                // Update fallback link placeholder and help for Telegram
                document.getElementById('botFallbackLink').placeholder = 'https://t.me/+ABC123... (optional if Bot Token set)';
                document.getElementById('fallbackLinkHelp').textContent = 'üí° Click "Auto-Generate" to let your bot create an invite link automatically';
            } else {
                instructionsDiv.innerHTML = `
                    <p style="margin: 0 0 8px 0;"><strong>Discord:</strong></p>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li>Go to <a href="https://discord.com/developers/applications" target="_blank" style="color: var(--secondary);">Discord Developer Portal</a></li>
                        <li>Create a New Application ‚Üí Bot ‚Üí Reset Token</li>
                        <li>Enable "SERVER MEMBERS INTENT" and "MESSAGE CONTENT INTENT"</li>
                        <li>Copy the Bot Token and invite bot to your server with Admin permissions</li>
                        <li>Click the <strong>üîç Detect Servers</strong> button below</li>
                    </ol>
                `;
                channelField.style.display = 'block';
                detectBtn.style.display = 'flex';
                detectBtn.style.background = 'linear-gradient(135deg, #5865F2, #4752C4)';
                detectBtn.innerHTML = 'üîç Detect Servers';
                groupIdHelp.textContent = 'üí° Or right-click your server ‚Üí Copy Server ID (enable Developer Mode in Settings)';
                
                // Update fallback link placeholder and help for Discord
                document.getElementById('botFallbackLink').placeholder = 'https://discord.gg/ABC123 (optional if Bot Token set)';
                document.getElementById('fallbackLinkHelp').textContent = 'üí° Click "Auto-Generate" to let your bot create a Discord invite link automatically';
            }
        }
        
        // Store last saved gate info for verification after clearing form
        let lastSavedGate = null;
        
        async function saveBotConfiguration() {
            const platform = document.getElementById('botPlatformSelect').value;
            const botToken = document.getElementById('botTokenInput').value.trim();
            const groupId = document.getElementById('botGroupId').value.trim();
            const channelId = document.getElementById('botChannelId')?.value?.trim() || '';
            const groupName = document.getElementById('botGroupName').value.trim();
            const fallbackLink = document.getElementById('botFallbackLink').value.trim();
            const minScore = parseInt(document.getElementById('minScoreSlider')?.value || '50');
            const statusDiv = document.getElementById('botConfigStatus');
            
            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }
            
            if (!botToken) {
                showBotStatus('error', '‚ùå Bot token is required');
                return;
            }
            
            if (!groupId) {
                showBotStatus('error', '‚ùå Group/Server ID is required');
                return;
            }
            
            // Fallback link is optional if bot token is provided (bot can generate links on-demand)
            if (!fallbackLink && !botToken) {
                showBotStatus('error', '‚ùå Either Bot Token or Static invite link is required');
                return;
            }
            
            showBotStatus('loading', '‚è≥ Saving configuration...');
            
            try {
                const response = await fetch(`${API_BASE}/api/gate/configure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        owner: connectedWallet,
                        platform: platform,
                        bot_token: botToken,
                        group_id: groupId,
                        channel_id: channelId,
                        group_name: groupName || `My ${platform} Community`,
                        static_invite_link: fallbackLink,
                        min_score: minScore
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const minScoreText = minScore > 50 ? ` | Min Score: ${minScore}` : '';
                    showBotStatus('success', `‚úÖ ${platform.charAt(0).toUpperCase() + platform.slice(1)} gate configured! Security: ${data.security_level.toUpperCase()}${minScoreText}`);
                    
                    // Store last saved gate for verification (before clearing form)
                    lastSavedGate = {
                        platform: platform,
                        group_id: groupId,
                        bot_token: botToken  // Keep temporarily for immediate verify
                    };
                    
                    // Refresh gate list AND status
                    await loadGateStatus();
                    await loadConfiguredGates();
                    
                    // Clear sensitive inputs for security
                    document.getElementById('botTokenInput').value = '';
                    
                    // Reset form for next gate
                    document.getElementById('botGroupId').value = '';
                    document.getElementById('botGroupName').value = '';
                    document.getElementById('botFallbackLink').value = '';
                    document.getElementById('minScoreSlider').value = '50';
                    updateScoreDisplay(50);
                } else {
                    showBotStatus('error', '‚ùå ' + (data.error || 'Failed to save configuration'));
                }
                
            } catch (error) {
                console.error('Error saving bot config:', error);
                showBotStatus('error', '‚ùå Failed to save: ' + error.message);
            }
        }
        
        async function verifyBotSetup() {
            const platform = document.getElementById('botPlatformSelect').value;
            const botToken = document.getElementById('botTokenInput').value.trim();
            const groupId = document.getElementById('botGroupId').value.trim();
            const statusDiv = document.getElementById('botConfigStatus');
            
            if (!connectedWallet) {
                alert('Please connect your wallet first');
                return;
            }
            
            // If bot_token and group_id are filled, do direct verification (before saving)
            // Otherwise check if we just saved a gate and can use that info
            // Finally fall back to owner+platform lookup
            let requestBody;
            
            if (botToken && groupId) {
                // Mode 2: Direct verification with token + group_id
                requestBody = { bot_token: botToken, group_id: groupId };
            } else if (lastSavedGate && lastSavedGate.bot_token && lastSavedGate.group_id) {
                // Just saved a gate - use that info for immediate verification
                requestBody = { bot_token: lastSavedGate.bot_token, group_id: lastSavedGate.group_id };
                // Clear the stored token after use (for security)
                setTimeout(() => { if (lastSavedGate) lastSavedGate.bot_token = null; }, 100);
            } else {
                // Mode 1: Lookup from saved config (needs group_id for multi-gate)
                // Try to get group_id from lastSavedGate or fail gracefully
                if (lastSavedGate && lastSavedGate.group_id) {
                    requestBody = { owner: connectedWallet, platform: platform, group_id: lastSavedGate.group_id };
                } else {
                    // No group_id - this will likely fail for multi-gate setups
                    requestBody = { owner: connectedWallet, platform: platform };
                }
            }
            
            showBotStatus('loading', '‚è≥ Verifying bot permissions...');
            
            try {
                const response = await fetch(`${API_BASE}/api/gate/verify-bot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (data.success && data.verified) {
                    showBotStatus('success', `‚úÖ Bot verified! Username: ${data.bot_username || 'Unknown'}<br>Can create invite links: ${data.can_invite ? 'Yes ‚úì' : 'No ‚úó'}`);
                    
                    // Refresh gate status
                    await loadGateStatus();
                } else {
                    showBotStatus('error', '‚ùå ' + (data.error || data.message || 'Bot verification failed'));
                }
                
            } catch (error) {
                console.error('Error verifying bot:', error);
                showBotStatus('error', '‚ùå Verification failed: ' + error.message);
            }
        }
        
        function showBotStatus(type, message) {
            const statusDiv = document.getElementById('botConfigStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = message;
            
            if (type === 'success') {
                statusDiv.style.background = 'rgba(16, 185, 129, 0.1)';
                statusDiv.style.border = '1px solid rgba(16, 185, 129, 0.3)';
                statusDiv.style.color = '#10b981';
            } else if (type === 'error') {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                statusDiv.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                statusDiv.style.color = '#ef4444';
            } else {
                statusDiv.style.background = 'rgba(59, 130, 246, 0.1)';
                statusDiv.style.border = '1px solid rgba(59, 130, 246, 0.3)';
                statusDiv.style.color = '#3b82f6';
            }
        }
        
        async function loadGateStatus() {
            if (!connectedWallet) return;
            
            const statusBadge = document.getElementById('gateSecurityStatus');
            
            try {
                // Check Telegram gate status
                const response = await fetch(`${API_BASE}/api/gate/status/${connectedWallet}?platform=telegram`);
                const data = await response.json();
                
                if (data.success && data.configured) {
                    statusBadge.style.display = 'block';
                    
                    const securityIcon = document.getElementById('securityIcon');
                    const securityLevel = document.getElementById('securityLevel');
                    const securityDescription = document.getElementById('securityDescription');
                    
                    if (data.security_level === 'high') {
                        statusBadge.style.background = 'rgba(16, 185, 129, 0.1)';
                        statusBadge.style.border = '1px solid rgba(16, 185, 129, 0.3)';
                        securityIcon.textContent = 'üõ°Ô∏è';
                        securityLevel.textContent = 'HIGH SECURITY';
                        securityLevel.style.color = '#10b981';
                        securityDescription.textContent = `Bot verified: ${data.bot_username || 'Yes'} ‚Ä¢ One-time links enabled`;
                        
                        // Pre-select advanced mode
                        selectSecurityMode('advanced');
                    } else if (data.security_level === 'low') {
                        // Bei Basic Security: Badge ausblenden und nur Modus vorausw√§hlen
                        statusBadge.style.display = 'none';
                        
                        // Pre-select basic mode
                        selectSecurityMode('basic');
                    }
                    
                    // Pre-fill group name if available
                    if (data.group_name) {
                        document.getElementById('botGroupName').value = data.group_name;
                        document.getElementById('privateGroupName').value = data.group_name;
                    }
                } else {
                    statusBadge.style.display = 'none';
                }
                
                // Load configured gates list
                await loadConfiguredGates();
                
            } catch (error) {
                console.error('Error loading gate status:', error);
                statusBadge.style.display = 'none';
            }
        }
        
        // ========================================
        // GATE LIST & DELETE FUNCTIONS
        // ========================================
        let pendingDeleteGate = null;
        
        async function loadConfiguredGates() {
            if (!connectedWallet) return;
            
            const listContainer = document.getElementById('configuredGatesList');
            listContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(240, 244, 255, 0.5);"><p style="margin: 0;">‚è≥ Loading...</p></div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/gate/list/${connectedWallet}`);
                const data = await response.json();
                
                if (data.success && data.gates && data.gates.length > 0) {
                    let html = '';
                    
                    for (const gate of data.gates) {
                        const platformIcon = gate.platform === 'telegram' ? '‚úàÔ∏è' : 'üí¨';
                        const platformName = gate.platform.charAt(0).toUpperCase() + gate.platform.slice(1);
                        const securityBadge = getSecurityBadge(gate.security_level);
                        const statusDot = gate.bot_verified ? 'üü¢' : (gate.has_static_link ? 'üü°' : 'üî¥');
                        
                        // Show last_updated if available, otherwise created_at
                        const displayDate = gate.last_updated || gate.created_at;
                        const dateLabel = gate.last_updated ? 'Updated' : 'Created';
                        const formattedDate = displayDate ? new Date(displayDate).toLocaleDateString('en-US') : 'N/A';
                        
                        // Min score badge
                        const minScore = gate.min_score || 50;
                        const minScoreBadge = minScore > 50 
                            ? `<span style="color: #a855f7; font-size: 0.75rem;">‚≠ê ${minScore}+ pts</span>` 
                            : '<span style="color: #10b981; font-size: 0.75rem;">üîì Open</span>';
                        
                        // Escape group_id for HTML attribute
                        const escapedGroupId = (gate.group_id || '').replace(/"/g, '&quot;');
                        const escapedGroupName = (gate.group_name || 'Unnamed Group').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        
                        // Invite Link display (direct community link)
                        const inviteLinkHtml = gate.invite_link 
                            ? `<div style="font-size: 0.75rem; margin-top: 6px; padding: 6px 8px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 4px; display: flex; align-items: center; gap: 8px;">
                                    <span style="color: #10b981;">üîó</span>
                                    <a href="${gate.invite_link}" target="_blank" style="color: var(--secondary); text-decoration: none; word-break: break-all; flex: 1;">${gate.invite_link}</a>
                                    <button onclick="copyToClipboard('${gate.invite_link}')" style="background: rgba(255,255,255,0.1); border: none; color: var(--light); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;" title="Copy Link">üìã</button>
                               </div>`
                            : `<div style="font-size: 0.7rem; margin-top: 4px; color: #f59e0b;">‚ö†Ô∏è No invite link configured</div>`;
                        
                        // Gate Access Link (for sharing with users - includes platform AND group!)
                        const baseUrl = window.location.origin;
                        // MULTI-GATE: Include group_id to identify specific gate
                        const gateAccessLink = `${baseUrl}/join-telegram?owner=${connectedWallet}&platform=${gate.platform}&group=${encodeURIComponent(gate.group_id)}`;
                        const gateAccessLinkHtml = `
                            <div style="font-size: 0.75rem; margin-top: 6px; padding: 6px 8px; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 4px;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="color: #667eea;">üé´</span>
                                    <span style="color: rgba(240, 244, 255, 0.7); font-size: 0.7rem;">Share this Gate Access Link for "${gate.group_name || 'this group'}":</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="text" value="${gateAccessLink}" readonly style="flex: 1; padding: 6px 8px; background: rgba(5, 8, 20, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: var(--secondary); font-size: 0.7rem; font-family: monospace;">
                                    <button onclick="copyToClipboard('${gateAccessLink}')" style="background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.4); color: var(--light); padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap;" title="Copy Gate Link">üìã Copy</button>
                                </div>
                            </div>
                        `;
                        
                        html += `
                            <div class="gate-card" style="padding: 14px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <span style="font-size: 1.8rem;">${platformIcon}</span>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 4px;">${gate.group_name || 'Unnamed Group'}</div>
                                            <div style="font-size: 0.8rem; opacity: 0.7;">
                                                ${statusDot} ${platformName} ‚Ä¢ ${securityBadge} ‚Ä¢ ${minScoreBadge}
                                            </div>
                                            <div style="font-size: 0.7rem; opacity: 0.5; margin-top: 2px;">
                                                ${dateLabel}: ${formattedDate}
                                                ${gate.group_id ? ` ‚Ä¢ <span style="font-family: monospace;">ID: ${gate.group_id}</span>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <button onclick="openDeleteModal('${gate.platform}', '${escapedGroupName}', '${escapedGroupId}')" 
                                            style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 6px; transition: all 0.2s;"
                                            onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'"
                                            onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                                ${inviteLinkHtml}
                                ${gateAccessLinkHtml}
                            </div>
                        `;
                    }
                    
                    listContainer.innerHTML = html;
                } else {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: rgba(240, 244, 255, 0.5); border: 1px dashed rgba(255, 255, 255, 0.1); border-radius: 8px;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üö´</div>
                            <p style="margin: 0 0 4px 0;">No gates configured</p>
                            <p style="margin: 0; font-size: 0.8rem;">Create your first gate above!</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading gates:', error);
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #ef4444;">
                        <p style="margin: 0;">‚ùå Error loading gates</p>
                    </div>
                `;
            }
        }
        
        function getSecurityBadge(level) {
            if (level === 'high') {
                return '<span style="color: #10b981; font-size: 0.75rem;">üõ°Ô∏è HIGH</span>';
            } else if (level === 'low') {
                return '<span style="color: #f59e0b; font-size: 0.75rem;">‚ö†Ô∏è BASIC</span>';
            } else {
                return '<span style="color: #ef4444; font-size: 0.75rem;">‚ùå NONE</span>';
            }
        }
        
        function openDeleteModal(platform, groupName, groupId) {
            pendingDeleteGate = { platform, groupName, groupId };
            document.getElementById('deleteGateName').innerHTML = `<span style="color: var(--secondary);">${groupName}</span> (${platform})`;
            document.getElementById('deleteGateModal').style.display = 'flex';
        }
        
        function closeDeleteModal() {
            pendingDeleteGate = null;
            document.getElementById('deleteGateModal').style.display = 'none';
        }
        
        async function confirmDeleteGate() {
            if (!pendingDeleteGate || !connectedWallet) {
                closeDeleteModal();
                return;
            }
            
            const { platform, groupName, groupId } = pendingDeleteGate;
            
            try {
                // MULTI-GATE: Include group_id in delete URL
                const deleteUrl = `${API_BASE}/api/gate/delete/${connectedWallet}/${platform}/${encodeURIComponent(groupId)}`;
                const response = await fetch(deleteUrl, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success notification
                    showNotification('success', `‚úÖ Gate "${groupName}" deleted successfully!`);
                    
                    // Close modal and refresh
                    closeDeleteModal();
                    await loadConfiguredGates();
                    await loadGateStatus();
                } else {
                    showNotification('error', `‚ùå Error: ${data.error || 'Delete failed'}`);
                    closeDeleteModal();
                }
                
            } catch (error) {
                console.error('Delete gate error:', error);
                showNotification('error', '‚ùå Network error while deleting');
                closeDeleteModal();
            }
        }
        
        function showNotification(type, message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10001;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;
            
            if (type === 'success') {
                notification.style.background = 'rgba(16, 185, 129, 0.95)';
                notification.style.border = '1px solid #10b981';
                notification.style.color = 'white';
            } else {
                notification.style.background = 'rgba(239, 68, 68, 0.95)';
                notification.style.border = '1px solid #ef4444';
                notification.style.color = 'white';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // ========================================
        // PROFILE EDITOR FUNCTIONS
        // ========================================
        const availableEmojis = [
            // === üåÄ SPIRALS & SWIRLS (VEra-Resonance Special!) ===
            'üåÄ', 'üí´', '‚ú®', 'üîÆ', '‚ôæÔ∏è', '‚òØÔ∏è', 'ü™¨', 'üßø', '‚öõÔ∏è', 'üîØ', '‚ò∏Ô∏è', '‚≠ï', 'üîµ', 'üü£', 'üü§', '‚ö´',
            'üåê', 'ü™©', 'üí†', 'üî∑', 'üî∂', 'üî¥', 'üü†', 'üü°', 'üü¢', 'üîµ', 'üü£', '‚ö™', 'ü©µ', 'ü©∑', 'ü©∂', 'üñ§',
            
            // === PEOPLE - Light Skin ===
            'üë§', 'üë®', 'üë©', 'üßë', 'üë¶', 'üëß', 'üßî', 'üë±', 'üë∏', 'ü§¥', 'ü¶∏', 'ü¶π', 'üßô', 'üßõ', 'üßú', 'üßù',
            'üëÆ', 'üë∑', 'üíÇ', 'üïµÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üßë‚Äçüé§', 'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üßë‚Äçüî¨',
            
            // === PEOPLE - Dark Skin ===
            'üèø', 'üë©üèø', 'üßëüèø', 'üë¶üèø', 'üëßüèø', 'üßîüèø', 'üë±üèø', 'üë∏üèø', 'ü§¥üèø', 'ü¶∏üèø', 'ü¶πüèø', 'üßôüèø', 'üßõüèø', 'üßúüèø', 'üßùüèø',
            'üëÆüèø', 'üë∑üèø', 'üíÇüèø', 'üïµüèø', 'üë©üèø‚Äç‚öïÔ∏è', 'üë®üèø‚Äç‚öïÔ∏è', 'üë©üèø‚Äçüéì', 'üë®üèø‚Äçüéì', 'üë©üèø‚Äçüíª', 'üë®üèø‚Äçüíª', 'üë©üèø‚ÄçüöÄ', 'üë®üèø‚ÄçüöÄ', 'üßëüèø‚Äçüé§', 'üë©üèø‚Äçüé§', 'üë®üèø‚Äçüé§', 'üßëüèø‚Äçüî¨',
            
            // === PEOPLE - Medium-Dark Skin ===
            'üë®üèæ', 'üë©üèæ', 'üßëüèæ', 'üë¶üèæ', 'üëßüèæ', 'üßîüèæ', 'üë∏üèæ', 'ü§¥üèæ', 'ü¶∏üèæ', 'ü¶πüèæ', 'üëÆüèæ', 'üë∑üèæ', 'üë©üèæ‚Äçüíª', 'üë®üèæ‚Äçüíª', 'üë©üèæ‚ÄçüöÄ', 'üë®üèæ‚ÄçüöÄ',
            
            // === PEOPLE - Medium Skin ===
            'üë®üèΩ', 'üë©üèΩ', 'üßëüèΩ', 'üë¶üèΩ', 'üëßüèΩ', 'üßîüèΩ', 'üë∏üèΩ', 'ü§¥üèΩ', 'ü¶∏üèΩ', 'ü¶πüèΩ', 'üëÆüèΩ', 'üë∑üèΩ', 'üë©üèΩ‚Äçüíª', 'üë®üèΩ‚Äçüíª', 'üë©üèΩ‚ÄçüöÄ', 'üë®üèΩ‚ÄçüöÄ',
            
            // === FACES & EXPRESSIONS ===
            'üòé', 'ü§ì', 'üßê', 'ü§†', 'ü•∏', 'üòà', 'üëπ', 'üë∫', 'ü§°', 'üíÄ', '‚ò†Ô∏è', 'üëª', 'üëΩ', 'üëæ', 'ü§ñ', 'üò∫',
            'üôÄ', 'üòª', 'üê±', 'ü¶ä', 'üê∫', 'üêª', 'üêº', 'üê®', 'ü¶Å', 'üêØ', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ',
            
            // === CRYPTO & TECH ===
            'üíé', 'üöÄ', '‚ö°', 'üî•', 'üí∞', 'ü™ô', 'üìä', 'üíª', 'üñ•Ô∏è', 'üì±', '‚å®Ô∏è', 'üîê', 'üîë', 'üõ°Ô∏è', '‚öôÔ∏è', 'ü§ñ',
            'üì°', 'üõ∞Ô∏è', 'üíæ', 'üíø', 'üîå', 'üîã', 'üí°', 'üî¶', 'üß≤', '‚öóÔ∏è', 'üß™', 'üî¨', 'üî≠', 'üìà', 'üìâ', 'üíπ',
            
            // === ANIMALS ===
            'ü¶ä', 'üê∫', 'ü¶Å', 'üêØ', 'üêª', 'üêº', 'ü¶Ñ', 'üêâ', 'ü¶Ö', 'ü¶ã', 'üêù', 'üêô', 'ü¶à', 'üê≥', 'ü¶é', 'üê¢',
            'üêç', 'ü¶ñ', 'ü¶ï', 'üêä', 'ü¶ú', 'ü¶ö', 'ü¶©', 'ü¶¢', 'ü¶≠', 'üêã', 'üê¨', 'ü¶ë', 'üê†', 'üê°', 'ü¶û', 'ü¶Ä',
            'üêÜ', 'üêÖ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'üêò', 'ü¶è', 'üê™', 'ü¶í', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'ü¶å', 'üêï', 'üêà',
            
            // === SPACE & NATURE ===
            'üåü', '‚≠ê', '‚ú®', 'üåô', '‚òÄÔ∏è', 'üåà', 'üåä', 'üèîÔ∏è', 'üåã', 'üåç', 'ü™ê', '‚òÑÔ∏è', 'üå∏', 'üå∫', 'üçÄ', 'üå¥',
            'üåµ', 'üå≤', 'üå≥', 'üçÇ', 'üçÅ', 'üåæ', 'üåª', 'üåπ', 'üíê', 'ü™∑', 'üåø', '‚òòÔ∏è', 'üçÉ', 'üå±', 'ü™¥', 'üéã',
            
            // === SYMBOLS & OBJECTS ===
            'üíú', 'üíô', 'üíö', 'üíõ', 'üß°', '‚ù§Ô∏è', 'üñ§', 'ü§ç', 'üí´', 'üéØ', 'üèÜ', 'üëë', 'üé≠', 'üé®', 'üéÆ', 'üé≤',
            'üÉè', 'üÄÑ', 'üé∞', 'üé±', 'üîÆ', 'üßø', 'ü™¨', 'üìø', 'üíé', 'üíç', 'üèÖ', 'ü•á', 'ü•à', 'ü•â', 'üéñÔ∏è', 'üèµÔ∏è',
            
            // === FOOD & DRINK ===
            'üçï', 'üçî', 'üçü', 'üåÆ', 'üç£', 'üç∞', 'üç©', '‚òï', 'üç∫', 'ü•É', 'üç∑', 'üç∏', 'ü•§', 'üßã', 'üçµ', 'ü´ñ',
            'üç´', 'üç¨', 'üç≠', 'üßÅ', 'üéÇ', 'ü•ß', 'üç™', 'üçø', 'ü•®', 'ü•Ø', 'ü´ì', 'ü•ê', 'üç≥', 'ü•û', 'üßá', 'ü•ì',
            
            // === FLAGS - Popular ===
            'üá∫üá∏', 'üá¨üáß', 'üá©üá™', 'üá´üá∑', 'üá™üá∏', 'üáÆüáπ', 'üáµüáπ', 'üá≥üá±', 'üáßüá™', 'üá¶üáπ', 'üá®üá≠', 'üáµüá±', 'üá®üáø', 'üá∏üá™', 'üá≥üá¥', 'üá©üá∞',
            'üá´üáÆ', 'üáÆüá™', 'üá¨üá∑', 'üáπüá∑', 'üá∑üá∫', 'üá∫üá¶', 'üáØüáµ', 'üá∞üá∑', 'üá®üá≥', 'üáÆüá≥', 'üáßüá∑', 'üá≤üáΩ', 'üá¶üá∑', 'üá®üá¶', 'üá¶üá∫', 'üá≥üáø',
            'üáøüá¶', 'üá≥üá¨', 'üá™üá¨', 'üá∞üá™', 'üá¨üá≠', 'üá≤üá¶', 'üá∏üá¶', 'üá¶üá™', 'üáÆüá±', 'üáπüá≠', 'üáªüá≥', 'üáÆüá©', 'üáµüá≠', 'üá≤üáæ', 'üá∏üá¨', 'üá≠üá∞',
            
            // === SPORTS & ACTIVITIES ===
            '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'ÔøΩ', 'üèì', 'üè∏', 'ü•ä', 'ü•ã', '‚õ≥', 'üèπ', 'üé£', 'ü§ø',
            'üèÑ', 'üèÇ', '‚õ∑Ô∏è', 'üßó', 'üö¥', 'üèãÔ∏è', 'ü§∏', 'ü§∫', 'üèá', '‚õπÔ∏è', 'ü§æ', 'üèä', 'üö£', 'üßò', 'üõπ', 'üõº',
            
            // === TRANSPORT & TRAVEL ===
            '‚úàÔ∏è', 'üöÄ', 'üõ∏', 'üöÅ', 'üõ©Ô∏è', 'üöÇ', 'üöÉ', 'üöó', 'üèéÔ∏è', 'üèçÔ∏è', 'üõµ', 'üö≤', 'üõ¥', 'üö¢', '‚õµ', 'üõ•Ô∏è',
            'üóº', 'üóΩ', 'üè∞', 'üèØ', 'üïå', '‚õ©Ô∏è', 'üïã', '‚õ™', 'üèõÔ∏è', 'üóø', 'üé°', 'üé¢', 'üé†', '‚õ≤', 'üåâ', 'üèùÔ∏è',
            
            // === FUN & CELEBRATION ===
            'ÔøΩüéâ', 'üéä', 'üéà', 'üéÅ', 'üéÄ', 'üéóÔ∏è', 'üéüÔ∏è', 'üé´', 'üé™', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéµ', 'üé∂', 'üé∑',
            'üé∏', 'üéπ', 'ü™ò', 'ü•Å', 'üé∫', 'ÔøΩ', 'ü™ï', 'ÔøΩ', 'üéÑ', 'üéÉ', 'üéÜ', 'üéá', 'ÔøΩ', '‚ú®', 'üéã', 'üéç'
        ];
        
        let selectedEmoji = 'üë§';
        let currentDisplayName = '';
        
        console.log('‚úèÔ∏è Profile Editor Functions loaded');
        
        function populateEmojiSelector() {
            console.log('üìù Populating emoji selector...');
            const container = document.getElementById('emojiSelector');
            if (!container) {
                console.error('‚ùå emojiSelector container not found!');
                return;
            }
            
            container.innerHTML = availableEmojis.map(emoji => `
                <button type="button" class="emoji-btn" data-emoji="${emoji}" onclick="selectEmoji('${emoji}')" style="
                    width: 36px;
                    height: 36px;
                    font-size: 1.3rem;
                    border: 2px solid transparent;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    cursor: pointer;
                    transition: all 0.15s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                " onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='scale(1.1)'" 
                   onmouseout="if(!this.classList.contains('selected')) { this.style.background='rgba(255,255,255,0.05)'; this.style.transform='scale(1)'; }">
                    ${emoji}
                </button>
            `).join('');
            
            // Mark currently selected emoji
            highlightSelectedEmoji(selectedEmoji);
        }
        
        function selectEmoji(emoji) {
            selectedEmoji = emoji;
            highlightSelectedEmoji(emoji);
            updatePreview();
        }
        
        function highlightSelectedEmoji(emoji) {
            // Remove selection from all
            document.querySelectorAll('#emojiSelector .emoji-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.borderColor = 'transparent';
                btn.style.background = 'rgba(255, 255, 255, 0.05)';
                btn.style.transform = 'scale(1)';
            });
            
            // Add selection to current
            const selectedBtn = document.querySelector(`#emojiSelector .emoji-btn[data-emoji="${emoji}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
                selectedBtn.style.borderColor = 'var(--secondary)';
                selectedBtn.style.background = 'rgba(102, 126, 234, 0.2)';
                selectedBtn.style.transform = 'scale(1.1)';
            }
        }
        
        function updatePreview() {
            const nameInput = document.getElementById('displayNameInput');
            const previewEmoji = document.getElementById('previewEmoji');
            const previewName = document.getElementById('previewName');
            
            if (previewEmoji) previewEmoji.textContent = selectedEmoji;
            
            if (previewName && nameInput) {
                const name = nameInput.value.trim();
                if (name) {
                    previewName.textContent = name;
                } else {
                    const shortAddr = connectedWallet ? connectedWallet.substring(0, 6) + '...' + connectedWallet.substring(38) : '0x...';
                    previewName.textContent = `Builder ${shortAddr}`;
                }
            }
        }
        
        function openProfileEditor() {
            console.log('‚úèÔ∏è openProfileEditor() called');
            console.log('   connectedWallet:', connectedWallet);
            
            if (!connectedWallet) {
                showNotification('error', '‚ùå Please connect your wallet first');
                return;
            }
            
            console.log('   Opening profile editor modal...');
            
            // Populate emojis
            populateEmojiSelector();
            
            // Get current values from display
            const currentAvatar = document.getElementById('statsAvatar');
            const currentName = document.getElementById('statsProfileName');
            
            if (currentAvatar) {
                selectedEmoji = currentAvatar.textContent.trim() || 'üë§';
            }
            
            if (currentName) {
                const nameText = currentName.textContent.trim();
                const shortAddr = connectedWallet.substring(0, 6) + '...' + connectedWallet.substring(38);
                // If it's the default name, leave input empty
                if (nameText === `Builder ${shortAddr}` || nameText.startsWith('Builder 0x')) {
                    currentDisplayName = '';
                } else {
                    currentDisplayName = nameText;
                }
            }
            
            // Set input value
            const nameInput = document.getElementById('displayNameInput');
            if (nameInput) nameInput.value = currentDisplayName;
            
            // Highlight current emoji
            highlightSelectedEmoji(selectedEmoji);
            
            // Update preview
            updatePreview();
            
            // Add input listener for live preview
            if (nameInput) {
                nameInput.oninput = updatePreview;
            }
            
            // Show modal
            document.getElementById('profileEditorModal').style.display = 'flex';
        }
        
        function closeProfileEditor() {
            document.getElementById('profileEditorModal').style.display = 'none';
        }
        
        async function saveProfile() {
            if (!connectedWallet) {
                showNotification('error', '‚ùå Wallet not connected');
                closeProfileEditor();
                return;
            }
            
            const nameInput = document.getElementById('displayNameInput');
            const displayName = nameInput ? nameInput.value.trim() : '';
            
            // Disable save button
            const saveBtn = document.getElementById('saveProfileBtn');
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.innerHTML = '‚è≥ Saving...';
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/user/update-profile`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        address: connectedWallet,
                        display_name: displayName,
                        avatar_emoji: selectedEmoji
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update UI immediately
                    const statsAvatar = document.getElementById('statsAvatar');
                    const statsProfileName = document.getElementById('statsProfileName');
                    
                    if (statsAvatar) statsAvatar.textContent = selectedEmoji;
                    
                    if (statsProfileName) {
                        if (displayName) {
                            statsProfileName.textContent = displayName;
                        } else {
                            const shortAddr = connectedWallet.substring(0, 6) + '...' + connectedWallet.substring(38);
                            statsProfileName.textContent = `Builder ${shortAddr}`;
                        }
                    }
                    
                    showNotification('success', '‚úÖ Profile updated successfully!');
                    closeProfileEditor();
                } else {
                    showNotification('error', `‚ùå Error: ${data.error || 'Update failed'}`);
                }
                
            } catch (error) {
                console.error('Profile update error:', error);
                showNotification('error', '‚ùå Network error while saving');
            } finally {
                // Re-enable save button
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = 'üíæ Save Profile';
                }
            }
        }

        // ========================================
        // SDK APP MANAGEMENT FUNCTIONS
        // ========================================
        function getAuthToken() {
            return localStorage.getItem('aera_jwt_token');
        }
        
        async function registerSdkApp() {
            const statusDiv = document.getElementById('registerAppStatus');
            const appName = document.getElementById('sdkAppName').value.trim();
            const websiteUrl = document.getElementById('sdkWebsiteUrl').value.trim();
            const redirectUri = document.getElementById('sdkRedirectUri').value.trim();
            const description = document.getElementById('sdkAppDescription').value.trim();
            
            if (!appName || appName.length < 3) {
                statusDiv.innerHTML = '<div style="color: #ef4444;">‚ùå App name must be at least 3 characters</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            if (!websiteUrl || !websiteUrl.startsWith('http')) {
                statusDiv.innerHTML = '<div style="color: #ef4444;">‚ùå Valid website URL required (https://...)</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            if (!redirectUri || !redirectUri.startsWith('http')) {
                statusDiv.innerHTML = '<div style="color: #ef4444;">‚ùå Valid redirect URI required (https://...)</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            const token = getAuthToken();
            if (!token) {
                statusDiv.innerHTML = '<div style="color: #ef4444;">‚ùå Please connect your wallet first and ensure you have an AEra NFT</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            statusDiv.innerHTML = '<div style="color: var(--secondary);">‚è≥ Registering your app...</div>';
            statusDiv.style.display = 'block';
            
            try {
                const response = await fetch('/api/oauth/my-apps/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        app_name: appName,
                        website_url: websiteUrl,
                        redirect_uri: redirectUri,
                        description: description
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('newClientId').textContent = data.client_id;
                    document.getElementById('newClientSecret').textContent = data.client_secret;
                    document.getElementById('newCredentialsDisplay').style.display = 'block';
                    
                    document.getElementById('sdkAppName').value = '';
                    document.getElementById('sdkWebsiteUrl').value = '';
                    document.getElementById('sdkRedirectUri').value = '';
                    document.getElementById('sdkAppDescription').value = '';
                    
                    statusDiv.innerHTML = '<div style="color: var(--success);">‚úÖ App registered successfully! Copy your credentials above.</div>';
                    
                    loadMyApps();
                } else {
                    statusDiv.innerHTML = `<div style="color: #ef4444;">‚ùå ${data.error}</div>`;
                }
            } catch (error) {
                console.error('Register app error:', error);
                statusDiv.innerHTML = '<div style="color: #ef4444;">‚ùå Network error. Please try again.</div>';
            }
        }
        
        function copyCredentials() {
            const clientId = document.getElementById('newClientId').textContent;
            const clientSecret = document.getElementById('newClientSecret').textContent;
            const text = `AERA_CLIENT_ID=${clientId}\nAERA_CLIENT_SECRET=${clientSecret}`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Credentials copied to clipboard!\n\nAdd these to your .env file.');
            }).catch(err => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ Credentials copied to clipboard!');
            });
        }
        
        async function loadMyApps() {
            const token = getAuthToken();
            const container = document.getElementById('myAppsList');
            
            if (!token) {
                container.innerHTML = '<div style="text-align: center; padding: 30px; color: rgba(240, 244, 255, 0.5);"><p>Connect your wallet to view your registered apps</p></div>';
                return;
            }
            
            container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(240, 244, 255, 0.5);">‚è≥ Loading your apps...</div>';
            
            try {
                const response = await fetch('/api/oauth/my-apps', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (data.apps.length === 0) {
                        container.innerHTML = '<div style="text-align: center; padding: 30px; color: rgba(240, 244, 255, 0.5);"><p>No apps registered yet. Create your first app above!</p></div>';
                    } else {
                        container.innerHTML = data.apps.map(app => `
                            <div style="padding: 16px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; transition: all 0.3s;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <div>
                                        <h4 style="margin: 0; color: var(--light); font-size: 14px;">${app.app_name}</h4>
                                        <a href="${app.website_url}" target="_blank" style="font-size: 12px; color: var(--secondary); text-decoration: none;">${app.website_url}</a>
                                    </div>
                                    <span style="font-size: 10px; padding: 3px 8px; background: ${app.is_active ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)'}; color: ${app.is_active ? 'var(--success)' : '#ef4444'}; border-radius: 4px;">${app.is_active ? '‚úì Active' : '‚úó Inactive'}</span>
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="font-size: 10px; color: rgba(240, 244, 255, 0.5); display: block;">CLIENT ID:</label>
                                    <code style="font-size: 11px; color: var(--secondary); word-break: break-all;">${app.client_id}</code>
                                </div>
                                ${app.description ? `<p style="font-size: 11px; color: rgba(240, 244, 255, 0.6); margin: 0 0 10px 0;">${app.description}</p>` : ''}
                                <div style="display: flex; gap: 8px; margin-top: 10px;">
                                    <button onclick="regenerateSecret('${app.client_id}')" class="cta-button" style="flex: 1; padding: 6px; font-size: 11px; background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; color: #f59e0b;">üîÑ New Secret</button>
                                    <button onclick="deleteApp('${app.client_id}', '${app.app_name}')" class="cta-button" style="flex: 1; padding: 6px; font-size: 11px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #ef4444;">üóëÔ∏è Delete</button>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    const countInfo = document.createElement('div');
                    countInfo.style.cssText = 'text-align: right; font-size: 11px; color: rgba(240, 244, 255, 0.5); margin-top: 8px;';
                    countInfo.textContent = `${data.count}/${data.max_apps} apps used`;
                    container.appendChild(countInfo);
                } else {
                    container.innerHTML = `<div style="color: #ef4444; padding: 20px;">‚ùå ${data.error}</div>`;
                }
            } catch (error) {
                console.error('Load apps error:', error);
                container.innerHTML = '<div style="color: #ef4444; padding: 20px;">‚ùå Failed to load apps</div>';
            }
        }
        
        async function regenerateSecret(clientId) {
            if (!confirm('‚ö†Ô∏è Are you sure you want to generate a new secret?\n\nThe old secret will stop working immediately!')) {
                return;
            }
            
            const token = getAuthToken();
            if (!token) {
                alert('‚ùå Please connect your wallet first');
                return;
            }
            
            try {
                const response = await fetch(`/api/oauth/my-apps/${clientId}/regenerate-secret`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('newClientId').textContent = data.client_id;
                    document.getElementById('newClientSecret').textContent = data.client_secret;
                    document.getElementById('newCredentialsDisplay').style.display = 'block';
                    
                    document.getElementById('newCredentialsDisplay').scrollIntoView({ behavior: 'smooth' });
                    
                    alert('‚úÖ New secret generated! Copy it from above - it won\'t be shown again.');
                } else {
                    alert(`‚ùå ${data.error}`);
                }
            } catch (error) {
                console.error('Regenerate secret error:', error);
                alert('‚ùå Network error. Please try again.');
            }
        }
        
        async function deleteApp(clientId, appName) {
            if (!confirm(`üóëÔ∏è Delete "${appName}"?\n\nThis action cannot be undone and all integrations using this app will stop working.`)) {
                return;
            }
            
            const token = getAuthToken();
            if (!token) {
                alert('‚ùå Please connect your wallet first');
                return;
            }
            
            try {
                const response = await fetch(`/api/oauth/my-apps/${clientId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ ${data.message}`);
                    loadMyApps();
                } else {
                    alert(`‚ùå ${data.error}`);
                }
            } catch (error) {
                console.error('Delete app error:', error);
                alert('‚ùå Network error. Please try again.');
            }
        }

        // ========================================
        // FOLLOWERS & BLOCKCHAIN DATA FUNCTIONS
        // ========================================
        async function loadOwnerStats() {
            if (!connectedWallet) return;
            
            try {
                console.log('üìä Loading owner stats...');
                // Use correct endpoint: /admin/followers?owner=...
                const response = await fetch(`${API_BASE}/admin/followers?owner=${connectedWallet}`);
                const data = await response.json();
                
                console.log('üìä Followers API response:', data);
                
                if (data.success) {
                    // Map correct field names from API response
                    document.getElementById('followerCount').textContent = data.total_followers || 0;
                    document.getElementById('avgScore').textContent = (data.statistics?.average_score || 0).toFixed(2);
                    document.getElementById('yourScore').textContent = data.owner_score || 0;
                    document.getElementById('followerCount2').textContent = `${data.total_followers || 0} verified followers`;
                    
                    // Display followers table
                    displayFollowersTable(data.followers || []);
                } else {
                    console.warn('‚ö†Ô∏è Followers API returned error:', data.error);
                    // Show empty state
                    document.getElementById('followerCount').textContent = '0';
                    document.getElementById('avgScore').textContent = '0';
                    document.getElementById('followerCount2').textContent = '0 verified followers';
                    displayFollowersTable([]);
                }
            } catch (error) {
                console.error('‚ùå Error loading owner stats:', error);
                // Show error state
                document.getElementById('followerCount').textContent = '‚Äî';
                document.getElementById('avgScore').textContent = '‚Äî';
                document.getElementById('followerCount2').textContent = 'Error loading followers';
            }
        }
        
        function displayFollowersTable(followers) {
            const container = document.getElementById('followersContainer');
            
            if (!followers || followers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: rgba(240, 244, 255, 0.5);"><p>No followers yet. Share your link to get started!</p></div>';
                return;
            }
            
            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Follower Address</th>
                            <th>Score</th>
                            <th>Platform</th>
                            <th>Verified At</th>
                            <th>Logins</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${followers.map(f => `
                            <tr data-platform="${f.source_platform || 'direct'}">
                                <td>${f.display_name || (f.follower_address ? f.follower_address.substring(0, 10) + '...' : 'Unknown')}</td>
                                <td><span class="score-badge">${f.resonance_score || 0}/100</span></td>
                                <td><span class="platform-badge">${f.source_platform || 'direct'}</span></td>
                                <td>${f.verified_at ? new Date(f.verified_at).toLocaleDateString() : '-'}</td>
                                <td>${f.login_count || 1}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function filterByPlatform(platform) {
            console.log('üîç Filtering by platform:', platform);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`[data-platform="${platform}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            const rows = document.querySelectorAll('#followersContainer tbody tr');
            rows.forEach(row => {
                const rowPlatform = row.getAttribute('data-platform');
                if (platform === 'all' || rowPlatform === platform) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        async function loadBlockchainData() {
            if (!connectedWallet) return;
            
            try {
                console.log('‚õìÔ∏è Loading blockchain data...');
                
                // Identity NFT Status - use correct endpoint
                const nftResponse = await fetch(`${API_BASE}/api/blockchain/identity/${connectedWallet}`);
                const nftData = await nftResponse.json();
                
                console.log('‚õìÔ∏è Identity NFT data:', nftData);
                
                if (nftData.has_identity && nftData.token_id) {
                    const tokenId = nftData.token_id;
                    const explorerUrl = nftData.basescan_url || `https://basescan.org/nft/${nftData.contract_address}/${tokenId}`;
                    document.getElementById('identityStatus').innerHTML = `
                        ‚úÖ <span style="color: var(--light);">Minted</span>
                        <br><span style="font-size: 0.7rem; opacity: 0.7;">Token #${tokenId}</span>
                        <br><a href="${explorerUrl}" target="_blank" style="color: var(--secondary); font-size: 0.65rem;">View on BaseScan ‚Üí</a>
                    `;
                } else if (nftData.identity_status === 'minting') {
                    document.getElementById('identityStatus').innerHTML = `
                        ‚è≥ <span style="color: var(--light);">Minting...</span>
                        <br><span style="font-size: 0.7rem; opacity: 0.7;">Please wait 30-60s</span>
                    `;
                } else {
                    document.getElementById('identityStatus').innerHTML = `
                        ‚è≥ <span style="color: var(--light);">Not Minted</span>
                        <br><span style="font-size: 0.7rem; opacity: 0.7;">Will auto-mint on first login</span>
                    `;
                }
                
                // Blockchain Score - use correct response fields with full breakdown
                const scoreResponse = await fetch(`${API_BASE}/api/blockchain/score/${connectedWallet}`);
                const scoreData = await scoreResponse.json();
                
                console.log('‚õìÔ∏è Score data:', scoreData);
                
                if (scoreData.blockchain_score !== undefined) {
                    const bcScore = scoreData.blockchain_score || 0;
                    const ownScore = scoreData.own_score || 0;
                    const followerBonus = scoreData.follower_bonus || 0;
                    const followerCount = scoreData.follower_count || 0;
                    const syncPending = scoreData.sync_pending || 0;
                    const lastSync = scoreData.last_sync ? formatTimestamp(scoreData.last_sync) : 'Never';
                    
                    // Blockchain Score with breakdown
                    document.getElementById('blockchainScore').innerHTML = `
                        ‚úÖ <span style="color: var(--light);">${bcScore}</span>
                        <br><span style="font-size: 0.6rem; opacity: 0.85;">Own: ${ownScore} + Follower Bonus: ${followerBonus}${followerCount > 0 ? ` (${followerCount} followers)` : ''}</span>
                    `;
                    
                    // Sync Status with pending info
                    if (syncPending > 0) {
                        document.getElementById('syncStatus').innerHTML = `
                            ‚è≥ <span style="color: var(--light);">Pending (+${syncPending})</span>
                            <br><span style="font-size: 0.65rem; opacity: 0.7;">${lastSync}</span>
                        `;
                    } else if (lastSync === 'Never') {
                        document.getElementById('syncStatus').innerHTML = `
                            ‚è∏Ô∏è <span style="color: var(--light);">Not Started</span>
                            <br><span style="font-size: 0.65rem; opacity: 0.7;">Waiting for first sync</span>
                        `;
                    } else {
                        document.getElementById('syncStatus').innerHTML = `
                            ‚úÖ <span style="color: var(--light);">Synced</span>
                            <br><span style="font-size: 0.65rem; opacity: 0.7;">${lastSync}</span>
                        `;
                    }
                } else if (scoreData.error) {
                    document.getElementById('blockchainScore').textContent = '‚Äî';
                    document.getElementById('syncStatus').innerHTML = `‚ùå <span style="color: var(--light);">Error</span>`;
                }
                
                // Blockchain Health with block number
                try {
                    const healthResponse = await fetch(`${API_BASE}/api/blockchain/stats`);
                    const healthData = await healthResponse.json();
                    const health = healthData.blockchain_health || {};
                    
                    if (health.status === 'connected') {
                        document.getElementById('blockchainHealth').innerHTML = `
                            üü¢ <span style="color: var(--light);">Online</span>
                            <br><span style="font-size: 0.65rem; opacity: 0.7;">Block ${health.block_number || 'N/A'}</span>
                        `;
                    } else {
                        document.getElementById('blockchainHealth').innerHTML = `
                            üî¥ <span style="color: var(--light);">Offline</span>
                            <br><span style="font-size: 0.65rem; opacity: 0.7;">${health.error || 'Connection error'}</span>
                        `;
                    }
                } catch (healthErr) {
                    document.getElementById('blockchainHealth').innerHTML = `
                        ‚ùå <span style="color: var(--light);">Error</span>
                    `;
                }
                
                // Load interaction history
                loadInteractionHistory();
                
            } catch (error) {
                console.error('‚ùå Error loading blockchain data:', error);
                document.getElementById('identityStatus').textContent = '‚ùå Error';
                document.getElementById('blockchainScore').textContent = '‚Äî';
                document.getElementById('syncStatus').textContent = '‚ùå Error';
                document.getElementById('blockchainHealth').textContent = '‚ùå Error';
            }
        }
        
        // Helper function to format timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'N/A';
            
            let date;
            if (typeof timestamp === 'number') {
                date = new Date(timestamp * 1000);
            } else if (typeof timestamp === 'string') {
                date = new Date(timestamp);
            } else {
                return 'Invalid Date';
            }
            
            if (isNaN(date.getTime())) return 'Invalid Date';
            
            return date.toLocaleString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        async function loadInteractionHistory() {
            if (!connectedWallet) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/blockchain/interactions/${connectedWallet}`);
                const data = await response.json();
                
                console.log('‚õìÔ∏è Interactions data:', data);
                
                const container = document.getElementById('interactionsContainer');
                const walletLower = connectedWallet.toLowerCase();
                
                // API doesn't return 'success' field - check for interactions array
                if (data.interactions && data.interactions.length > 0) {
                    document.getElementById('interactionCount').textContent = `${data.total || data.interactions.length} interactions`;
                    
                    container.innerHTML = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>With</th>
                                    <th>Date</th>
                                    <th>TX</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.interactions.slice(0, 20).map(i => {
                                    // Determine if this user is initiator or responder
                                    const isInitiator = i.initiator?.toLowerCase() === walletLower;
                                    const otherAddress = isInitiator ? i.responder : i.initiator;
                                    const typeIcon = i.interaction_type_name || 'FOLLOW';
                                    const typeDisplay = isInitiator ? `‚û°Ô∏è ${typeIcon}` : `‚¨ÖÔ∏è ${typeIcon}`;
                                    const shortAddr = otherAddress ? `${otherAddress.substring(0, 6)}...${otherAddress.substring(38)}` : '-';
                                    // timestamp from API is Unix timestamp (seconds)
                                    const dateStr = i.timestamp ? new Date(i.timestamp * 1000).toLocaleDateString() : '-';
                                    
                                    return `
                                        <tr>
                                            <td>${typeDisplay}</td>
                                            <td>${shortAddr}</td>
                                            <td>${dateStr}</td>
                                            <td>${i.tx_hash ? `<a href="https://basescan.org/tx/${i.tx_hash}" target="_blank" class="basescan-link">üîó</a>` : '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    document.getElementById('interactionCount').textContent = 'No interactions yet';
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: rgba(240, 244, 255, 0.5);"><p>No blockchain interactions recorded yet.</p></div>';
                }
            } catch (error) {
                console.error('‚ùå Error loading interactions:', error);
                document.getElementById('interactionsContainer').innerHTML = '<div style="color: #ef4444; padding: 20px;">‚ùå Failed to load interactions</div>';
            }
        }
        
        function toggleCollapse(contentId) {
            const content = document.getElementById(contentId);
            const btn = event.target;
            
            if (!content) return;
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                btn.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                btn.textContent = '‚ñ∂';
            }
        }

        // ========================================
        // INITIALIZATION
        // ========================================
        async function initDashboard() {
            console.log('üîê [User Dashboard] Initializing...');
            
            // Check if wallet is connected from session
            const storedWallet = sessionStorage.getItem('aeraDashboardWallet');
            const storedToken = sessionStorage.getItem('aeraDashboardToken');
            
            if (!storedWallet || !storedToken) {
                console.log('‚ùå No wallet session found - showing access denied...');
                showAccessDenied();
                return;
            }
            
            // Validate session by checking if user exists in backend and was recently active
            try {
                console.log('üîç Validating session with backend...');
                const response = await fetch('/api/user/profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: storedWallet })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    console.log('‚ùå User not found in backend - clearing session...');
                    sessionStorage.removeItem('aeraDashboardWallet');
                    sessionStorage.removeItem('aeraDashboardToken');
                    showAccessDenied();
                    return;
                }
                
                // Check if user was active in last 24 hours (last_login from join_date or score > 0)
                // For now, just checking if user exists is enough
                console.log('‚úÖ Session validated - user exists in backend');
                
            } catch (error) {
                console.error('‚ùå Backend validation failed:', error);
                showAccessDenied();
                return;
            }
            
            connectedWallet = storedWallet;
            console.log('‚úÖ Wallet session restored:', connectedWallet);
            
            // Load user data
            await loadUserData();
            loadFeed();
            
            // Load Profile NFT status
            await loadProfileNFTStatus();
            
            // Load owner stats, followers & blockchain data
            await loadOwnerStats();
            await loadBlockchainData();
            
            // Load SDK apps
            loadMyApps();
            
            // Load Gate Security Status
            await loadGateStatus();
        }
        
        // Show access denied message and redirect
        function showAccessDenied() {
            document.querySelector('.main-container').innerHTML = `
                <div class="card" style="text-align: center; padding: 3rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üîê</div>
                    <h2 style="color: var(--error); margin-bottom: 1rem;">Access Restricted</h2>
                    <p style="margin-bottom: 2rem; opacity: 0.8;">
                        Please connect your wallet on the Dashboard first to access AEra Core.
                    </p>
                    <a href="dashboard.html" class="disconnect-btn" style="
                        display: inline-block;
                        padding: 1rem 2rem;
                        background: linear-gradient(135deg, var(--primary), var(--accent));
                        color: white;
                        border: none;
                        border-radius: 8px;
                        text-decoration: none;
                        font-weight: 600;
                    ">Go to Dashboard</a>
                </div>
            `;
        }

        // ========================================
        // LOAD USER DATA FROM BACKEND
        // ========================================
        async function loadUserData() {
            try {
                console.log('üìä Loading user data...');
                
                // Update basic profile immediately
                const shortAddr = connectedWallet.substring(0, 6) + '...' + connectedWallet.substring(38);
                
                // Profile Section is hidden, but check if elements exist
                const profileNameEl = document.getElementById('profileName');
                const profileAddressEl = document.getElementById('profileAddress');
                if (profileNameEl) profileNameEl.textContent = `Welcome, Builder`;
                if (profileAddressEl) profileAddressEl.textContent = connectedWallet;
                
                // Update Stats Section header with wallet info
                document.getElementById('statsProfileName').textContent = `Builder ${shortAddr}`;
                document.getElementById('statsProfileAddress').textContent = connectedWallet;
                
                // Get user info from backend
                const response = await fetch(`${API_BASE}/api/user/profile`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: connectedWallet })
                });
                
                const data = await response.json();
                console.log('üìä Profile API response:', data);
                
                if (data.success) {
                    userNFTData = data;
                    
                    // Update profile with real data
                    const displayName = data.display_name || `Builder ${shortAddr}`;
                    const avatarEmoji = data.avatar_emoji || 'üë§';
                    
                    if (profileNameEl) profileNameEl.textContent = displayName;
                    if (profileAddressEl) profileAddressEl.textContent = connectedWallet;
                    
                    // Update Stats Section header with display name and avatar
                    document.getElementById('statsProfileName').textContent = displayName;
                    document.getElementById('statsAvatar').textContent = avatarEmoji;
                    
                    // Profile Section elements (may be hidden/commented out)
                    const userStatusEl = document.getElementById('userStatus');
                    const userScoreEl = document.getElementById('userScore');
                    const communityCountEl = document.getElementById('communityCount');
                    const memberSinceEl = document.getElementById('memberSince');
                    
                    // Status with NFT info
                    if (userStatusEl) {
                        if (data.nft_verified) {
                            userStatusEl.innerHTML = `<span style="color: var(--success);">Verified ‚úì</span>`;
                        } else {
                            userStatusEl.innerHTML = `<span style="color: var(--warning);">Pending</span>`;
                        }
                    }
                    
                    // Score display with breakdown
                    if (userScoreEl) {
                        const totalScore = data.score || 0;
                        const ownScore = data.own_score || 0;
                        const followerBonus = data.follower_bonus || 0;
                        userScoreEl.innerHTML = `
                            ${totalScore.toFixed(0)}
                            <div style="font-size: 0.6rem; opacity: 0.7; margin-top: 4px;">
                                Own: ${ownScore.toFixed(0)} + Bonus: ${followerBonus.toFixed(0)}
                            </div>
                        `;
                    }
                    
                    // Community count
                    if (communityCountEl) communityCountEl.textContent = data.communities || '0';
                    
                    // Format member since date
                    if (memberSinceEl) {
                        if (data.join_date) {
                            const joinDate = new Date(data.join_date);
                            const options = { month: 'short', year: 'numeric' };
                            memberSinceEl.textContent = joinDate.toLocaleDateString('en-US', options);
                        } else {
                            memberSinceEl.textContent = 'New';
                        }
                    }
                    
                    console.log('‚úÖ User data loaded:', data);
                } else {
                    console.warn('‚ö†Ô∏è Could not load user data:', data.error);
                }
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                // Profile Section may be hidden - no error handling needed
            }
        }

        // ========================================
        // LOAD FEED
        // ========================================
        function loadFeed() {
            console.log('üì∞ Loading feed...');
            
            const feedContainer = document.getElementById('feedContainer');
            if (!feedContainer) {
                console.log('üì∞ Feed container not found - feed section is disabled');
                return;
            }
            
            if (feedData.length === 0) {
                feedContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div>No updates yet. Check back soon!</div>
                    </div>
                `;
                return;
            }
            
            // Render feed items
            feedContainer.innerHTML = feedData.map(item => `
                <div class="feed-item">
                    <div class="feed-item-header">
                        <div>
                            <div class="feed-item-title">${item.title}</div>
                            <span class="feed-item-badge badge-${item.badge}">${item.badge.toUpperCase()}</span>
                        </div>
                        <div class="feed-item-timestamp">${item.timestamp}</div>
                    </div>
                    <div class="feed-item-content">${item.content}</div>
                    ${item.link ? `<a href="${item.link}" class="feed-item-link">Learn more ‚Üí</a>` : ''}
                </div>
            `).join('');
            
            console.log('‚úÖ Feed loaded');
        }

        // ========================================
        // DISCONNECT WALLET
        // ========================================
        function disconnectWallet() {
            if (confirm('Disconnect wallet and return to dashboard?')) {
                sessionStorage.removeItem('aeraDashboardWallet');
                sessionStorage.removeItem('aeraDashboardToken');
                window.location.href = 'dashboard.html';
            }
        }

        // ========================================
        // PAGE LOAD
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ User Dashboard loaded');
            createParticles();
            initDashboard();
            
            // ========================================
            // PROFILE EDITOR - Direct Event Listeners (Fallback)
            // ========================================
            // Add click listeners directly to ensure they work
            const editBtn = document.getElementById('editProfileBtn');
            const statsAvatar = document.getElementById('statsAvatar');
            
            if (editBtn) {
                console.log('‚úèÔ∏è Adding direct click listener to editProfileBtn');
                editBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('‚úèÔ∏è Edit button clicked (direct listener)');
                    openProfileEditor();
                });
            } else {
                console.error('‚ùå editProfileBtn not found in DOM!');
            }
            
            if (statsAvatar) {
                console.log('‚úèÔ∏è Adding direct click listener to statsAvatar');
                statsAvatar.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('‚úèÔ∏è Avatar clicked (direct listener)');
                    openProfileEditor();
                });
            } else {
                console.error('‚ùå statsAvatar not found in DOM!');
            }
        });
    </script>

    <!-- ========================================
         PROFILE EDITOR MODAL (Global Overlay)
         ======================================== -->
    <div id="profileEditorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 99999; justify-content: center; align-items: flex-start; padding-top: 80px; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid rgba(102, 126, 234, 0.4); border-radius: 16px; padding: 28px; max-width: 520px; width: 95%; box-shadow: 0 25px 80px rgba(0, 0, 0, 0.7); margin-bottom: 40px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #667eea; font-size: 1.25rem;">‚úèÔ∏è Edit Profile</h3>
                <button onclick="closeProfileEditor()" style="background: transparent; border: none; color: #f0f4ff; font-size: 1.8rem; cursor: pointer; opacity: 0.7; padding: 0; line-height: 1;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">√ó</button>
            </div>
            
            <!-- Emoji Selector -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px; color: #f0f4ff;">Choose your avatar emoji: <span style="opacity: 0.5; font-size: 0.8rem;">(300+ options)</span></label>
                <div id="emojiSelector" style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 6px; padding: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; max-height: 280px; overflow-y: auto;">
                    <!-- Emojis will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Display Name Input -->
            <div style="margin-bottom: 24px;">
                <label style="display: block; font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px; color: #f0f4ff;">Display name:</label>
                <input type="text" id="displayNameInput" placeholder="Enter your display name..." maxlength="30" style="
                    width: 100%;
                    padding: 14px 16px;
                    background: rgba(0, 0, 0, 0.4);
                    border: 1px solid rgba(255, 255, 255, 0.15);
                    border-radius: 8px;
                    color: #f0f4ff;
                    font-size: 1rem;
                    box-sizing: border-box;
                    transition: border-color 0.2s ease;
                " onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.15)'">
                <small style="display: block; margin-top: 6px; opacity: 0.5; font-size: 0.8rem; color: #f0f4ff;">Max 30 characters. Leave empty for default (Builder + wallet).</small>
            </div>
            
            <!-- Preview -->
            <div style="margin-bottom: 24px; padding: 16px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.2);">
                <div style="font-size: 0.75rem; text-transform: uppercase; opacity: 0.6; margin-bottom: 8px; letter-spacing: 1px; color: #f0f4ff;">Preview</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="previewEmoji" style="font-size: 1.5rem;">üë§</span>
                    <span id="previewName" style="font-size: 1.1rem; font-weight: 500; color: #f0f4ff;">Builder</span>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px;">
                <button onclick="closeProfileEditor()" style="flex: 1; padding: 14px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: #f0f4ff; cursor: pointer; font-size: 0.95rem; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">Cancel</button>
                <button onclick="saveProfile()" id="saveProfileBtn" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">üíæ Save Profile</button>
            </div>
        </div>
    </div>

</body>
</html>
